import{e as Tt,I as Mi}from"./events.1ce70653.js";import{c as nt,g as Ro,b as Uo}from"./index.9bff1f98.js";import{b as ji,s as Ss,a as Os,d as Is,i as En,c as Lo,e as Mo,g as xs,f as $i,h as jo,J as yr,j as zi,k as Hi,l as Rt,m as Pt,n as Ps,o as Bi,H as Vr}from"./index.ce6ae0a0.js";import{r as $o}from"./___vite-browser-external_commonjs-proxy.78703349.js";function zo(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}var Ho=Bo;function Bo(r,e,t){var i=t&&t.stringify||zo,n=1;if(typeof r=="object"&&r!==null){var c=e.length+n;if(c===1)return r;var y=new Array(c);y[0]=i(r);for(var d=1;d<c;d++)y[d]=i(e[d]);return y.join(" ")}if(typeof r!="string")return r;var g=e.length;if(g===0)return r;for(var I="",S=1-n,A=-1,z=r&&r.length||0,N=0;N<z;){if(r.charCodeAt(N)===37&&N+1<z){switch(A=A>-1?A:0,r.charCodeAt(N+1)){case 100:case 102:if(S>=g||e[S]==null)break;A<N&&(I+=r.slice(A,N)),I+=Number(e[S]),A=N+2,N++;break;case 105:if(S>=g||e[S]==null)break;A<N&&(I+=r.slice(A,N)),I+=Math.floor(Number(e[S])),A=N+2,N++;break;case 79:case 111:case 106:if(S>=g||e[S]===void 0)break;A<N&&(I+=r.slice(A,N));var T=typeof e[S];if(T==="string"){I+="'"+e[S]+"'",A=N+2,N++;break}if(T==="function"){I+=e[S].name||"<anonymous>",A=N+2,N++;break}I+=i(e[S]),A=N+2,N++;break;case 115:if(S>=g)break;A<N&&(I+=r.slice(A,N)),I+=String(e[S]),A=N+2,N++;break;case 37:A<N&&(I+=r.slice(A,N)),I+="%",A=N+2,N++,S--;break}++S}++N}return A===-1?r:(A<z&&(I+=r.slice(A)),I)}const Dn=Ho;var _r=St;const dr=Zo().console||{},Ko={mapHttpRequest:Ur,mapHttpResponse:Ur,wrapRequestSerializer:hi,wrapResponseSerializer:hi,wrapErrorSerializer:hi,req:Ur,res:Ur,err:ko};function qo(r,e){return Array.isArray(r)?r.filter(function(i){return i!=="!stdSerializers.err"}):r===!0?Object.keys(e):!1}function St(r){r=r||{},r.browser=r.browser||{};const e=r.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const t=r.browser.write||dr;r.browser.write&&(r.browser.asObject=!0);const i=r.serializers||{},n=qo(r.browser.serialize,i);let c=r.browser.serialize;Array.isArray(r.browser.serialize)&&r.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const y=["error","fatal","warn","info","debug","trace"];typeof t=="function"&&(t.error=t.fatal=t.warn=t.info=t.debug=t.trace=t),r.enabled===!1&&(r.level="silent");const d=r.level||"info",g=Object.create(t);g.log||(g.log=pr),Object.defineProperty(g,"levelVal",{get:S}),Object.defineProperty(g,"level",{get:A,set:z});const I={transmit:e,serialize:n,asObject:r.browser.asObject,levels:y,timestamp:Yo(r)};g.levels=St.levels,g.level=d,g.setMaxListeners=g.getMaxListeners=g.emit=g.addListener=g.on=g.prependListener=g.once=g.prependOnceListener=g.removeListener=g.removeAllListeners=g.listeners=g.listenerCount=g.eventNames=g.write=g.flush=pr,g.serializers=i,g._serialize=n,g._stdErrSerialize=c,g.child=N,e&&(g._logEvent=wi());function S(){return this.level==="silent"?1/0:this.levels.values[this.level]}function A(){return this._level}function z(T){if(T!=="silent"&&!this.levels.values[T])throw Error("unknown level "+T);this._level=T,Xt(I,g,"error","log"),Xt(I,g,"fatal","error"),Xt(I,g,"warn","error"),Xt(I,g,"info","log"),Xt(I,g,"debug","log"),Xt(I,g,"trace","log")}function N(T,B){if(!T)throw new Error("missing bindings for child Pino");B=B||{},n&&T.serializers&&(B.serializers=T.serializers);const M=B.serializers;if(n&&M){var K=Object.assign({},i,M),_=r.browser.serialize===!0?Object.keys(K):n;delete T.serializers,Gr([T],_,K,this._stdErrSerialize)}function D(b){this._childLevel=(b._childLevel|0)+1,this.error=Zt(b,T,"error"),this.fatal=Zt(b,T,"fatal"),this.warn=Zt(b,T,"warn"),this.info=Zt(b,T,"info"),this.debug=Zt(b,T,"debug"),this.trace=Zt(b,T,"trace"),K&&(this.serializers=K,this._serialize=_),e&&(this._logEvent=wi([].concat(b._logEvent.bindings,T)))}return D.prototype=this,new D(this)}return g}St.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};St.stdSerializers=Ko;St.stdTimeFunctions=Object.assign({},{nullTime:Ts,epochTime:As,unixTime:Jo,isoTime:Xo});function Xt(r,e,t,i){const n=Object.getPrototypeOf(e);e[t]=e.levelVal>e.levels.values[t]?pr:n[t]?n[t]:dr[t]||dr[i]||pr,Vo(r,e,t)}function Vo(r,e,t){!r.transmit&&e[t]===pr||(e[t]=function(i){return function(){const c=r.timestamp(),y=new Array(arguments.length),d=Object.getPrototypeOf&&Object.getPrototypeOf(this)===dr?dr:this;for(var g=0;g<y.length;g++)y[g]=arguments[g];if(r.serialize&&!r.asObject&&Gr(y,this._serialize,this.serializers,this._stdErrSerialize),r.asObject?i.call(d,Go(this,t,y,c)):i.apply(d,y),r.transmit){const I=r.transmit.level||e.level,S=St.levels.values[I],A=St.levels.values[t];if(A<S)return;Wo(this,{ts:c,methodLevel:t,methodValue:A,transmitLevel:I,transmitValue:St.levels.values[r.transmit.level||e.level],send:r.transmit.send,val:e.levelVal},y)}}}(e[t]))}function Go(r,e,t,i){r._serialize&&Gr(t,r._serialize,r.serializers,r._stdErrSerialize);const n=t.slice();let c=n[0];const y={};i&&(y.time=i),y.level=St.levels.values[e];let d=(r._childLevel|0)+1;if(d<1&&(d=1),c!==null&&typeof c=="object"){for(;d--&&typeof n[0]=="object";)Object.assign(y,n.shift());c=n.length?Dn(n.shift(),n):void 0}else typeof c=="string"&&(c=Dn(n.shift(),n));return c!==void 0&&(y.msg=c),y}function Gr(r,e,t,i){for(const n in r)if(i&&r[n]instanceof Error)r[n]=St.stdSerializers.err(r[n]);else if(typeof r[n]=="object"&&!Array.isArray(r[n]))for(const c in r[n])e&&e.indexOf(c)>-1&&c in t&&(r[n][c]=t[c](r[n][c]))}function Zt(r,e,t){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return r[t].apply(this,i)}}function Wo(r,e,t){const i=e.send,n=e.ts,c=e.methodLevel,y=e.methodValue,d=e.val,g=r._logEvent.bindings;Gr(t,r._serialize||Object.keys(r.serializers),r.serializers,r._stdErrSerialize===void 0?!0:r._stdErrSerialize),r._logEvent.ts=n,r._logEvent.messages=t.filter(function(I){return g.indexOf(I)===-1}),r._logEvent.level.label=c,r._logEvent.level.value=y,i(c,r._logEvent,d),r._logEvent=wi(g)}function wi(r){return{ts:0,messages:[],bindings:r||[],level:{label:"",value:0}}}function ko(r){const e={type:r.constructor.name,msg:r.message,stack:r.stack};for(const t in r)e[t]===void 0&&(e[t]=r[t]);return e}function Yo(r){return typeof r.timestamp=="function"?r.timestamp:r.timestamp===!1?Ts:As}function Ur(){return{}}function hi(r){return r}function pr(){}function Ts(){return!1}function As(){return Date.now()}function Jo(){return Math.round(Date.now()/1e3)}function Xo(){return new Date(Date.now()).toISOString()}function Zo(){function r(e){return typeof e!="undefined"&&e}try{return typeof globalThis!="undefined"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return r(self)||r(window)||r(this)||{}}}var Wr={},Ki={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,c,y,d,g,I,S,A,z,N,T,B,M,K,_,D,b,w,m,s;(function(h){var H=typeof nt=="object"?nt:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(r.exports)));function o(l,f){return l!==H&&(typeof Object.create=="function"?Object.defineProperty(l,"__esModule",{value:!0}):l.__esModule=!0),function(v,p){return l[v]=f?f(v,p):p}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var f in l)l.hasOwnProperty(f)&&(o[f]=l[f])};e=function(o,l){H(o,l);function f(){this.constructor=o}o.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)},t=Object.assign||function(o){for(var l,f=1,v=arguments.length;f<v;f++){l=arguments[f];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(o[p]=l[p])}return o},i=function(o,l){var f={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&l.indexOf(v)<0&&(f[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,v=Object.getOwnPropertySymbols(o);p<v.length;p++)l.indexOf(v[p])<0&&Object.prototype.propertyIsEnumerable.call(o,v[p])&&(f[v[p]]=o[v[p]]);return f},n=function(o,l,f,v){var p=arguments.length,u=p<3?l:v===null?v=Object.getOwnPropertyDescriptor(l,f):v,P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,l,f,v);else for(var R=o.length-1;R>=0;R--)(P=o[R])&&(u=(p<3?P(u):p>3?P(l,f,u):P(l,f))||u);return p>3&&u&&Object.defineProperty(l,f,u),u},c=function(o,l){return function(f,v){l(f,v,o)}},y=function(o,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,l)},d=function(o,l,f,v){function p(u){return u instanceof f?u:new f(function(P){P(u)})}return new(f||(f=Promise))(function(u,P){function R(j){try{O(v.next(j))}catch(q){P(q)}}function $(j){try{O(v.throw(j))}catch(q){P(q)}}function O(j){j.done?u(j.value):p(j.value).then(R,$)}O((v=v.apply(o,l||[])).next())})},g=function(o,l){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},v,p,u,P;return P={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function R(O){return function(j){return $([O,j])}}function $(O){if(v)throw new TypeError("Generator is already executing.");for(;f;)try{if(v=1,p&&(u=O[0]&2?p.return:O[0]?p.throw||((u=p.return)&&u.call(p),0):p.next)&&!(u=u.call(p,O[1])).done)return u;switch(p=0,u&&(O=[O[0]&2,u.value]),O[0]){case 0:case 1:u=O;break;case 4:return f.label++,{value:O[1],done:!1};case 5:f.label++,p=O[1],O=[0];continue;case 7:O=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(O[0]===6||O[0]===2)){f=0;continue}if(O[0]===3&&(!u||O[1]>u[0]&&O[1]<u[3])){f.label=O[1];break}if(O[0]===6&&f.label<u[1]){f.label=u[1],u=O;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(O);break}u[2]&&f.ops.pop(),f.trys.pop();continue}O=l.call(o,f)}catch(j){O=[6,j],p=0}finally{v=u=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},s=function(o,l,f,v){v===void 0&&(v=f),o[v]=l[f]},I=function(o,l){for(var f in o)f!=="default"&&!l.hasOwnProperty(f)&&(l[f]=o[f])},S=function(o){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&o[l],v=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,l){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var v=f.call(o),p,u=[],P;try{for(;(l===void 0||l-- >0)&&!(p=v.next()).done;)u.push(p.value)}catch(R){P={error:R}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(P)throw P.error}}return u},z=function(){for(var o=[],l=0;l<arguments.length;l++)o=o.concat(A(arguments[l]));return o},N=function(){for(var o=0,l=0,f=arguments.length;l<f;l++)o+=arguments[l].length;for(var v=Array(o),p=0,l=0;l<f;l++)for(var u=arguments[l],P=0,R=u.length;P<R;P++,p++)v[p]=u[P];return v},T=function(o){return this instanceof T?(this.v=o,this):new T(o)},B=function(o,l,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f.apply(o,l||[]),p,u=[];return p={},P("next"),P("throw"),P("return"),p[Symbol.asyncIterator]=function(){return this},p;function P(G){v[G]&&(p[G]=function(V){return new Promise(function(Q,Y){u.push([G,V,Q,Y])>1||R(G,V)})})}function R(G,V){try{$(v[G](V))}catch(Q){q(u[0][3],Q)}}function $(G){G.value instanceof T?Promise.resolve(G.value.v).then(O,j):q(u[0][2],G)}function O(G){R("next",G)}function j(G){R("throw",G)}function q(G,V){G(V),u.shift(),u.length&&R(u[0][0],u[0][1])}},M=function(o){var l,f;return l={},v("next"),v("throw",function(p){throw p}),v("return"),l[Symbol.iterator]=function(){return this},l;function v(p,u){l[p]=o[p]?function(P){return(f=!f)?{value:T(o[p](P)),done:p==="return"}:u?u(P):P}:u}},K=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=o[Symbol.asyncIterator],f;return l?l.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),f={},v("next"),v("throw"),v("return"),f[Symbol.asyncIterator]=function(){return this},f);function v(u){f[u]=o[u]&&function(P){return new Promise(function(R,$){P=o[u](P),p(R,$,P.done,P.value)})}}function p(u,P,R,$){Promise.resolve($).then(function(O){u({value:O,done:R})},P)}},_=function(o,l){return Object.defineProperty?Object.defineProperty(o,"raw",{value:l}):o.raw=l,o},D=function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(l[f]=o[f]);return l.default=o,l},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,l){if(!l.has(o))throw new TypeError("attempted to get private field on non-instance");return l.get(o)},m=function(o,l,f){if(!l.has(o))throw new TypeError("attempted to set private field on non-instance");return l.set(o,f),f},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",c),h("__metadata",y),h("__awaiter",d),h("__generator",g),h("__exportStar",I),h("__createBinding",s),h("__values",S),h("__read",A),h("__spread",z),h("__spreadArrays",N),h("__await",T),h("__asyncGenerator",B),h("__asyncDelegator",M),h("__asyncValues",K),h("__makeTemplateObject",_),h("__importStar",D),h("__importDefault",b),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",m)})})(Ki);var br={};Object.defineProperty(br,"__esModule",{value:!0});function Qo(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}br.safeJsonParse=Qo;function ec(r){return typeof r=="string"?r:JSON.stringify(r,(e,t)=>typeof t=="undefined"?null:t)}br.safeJsonStringify=ec;var $r={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof nt!="undefined"&&nt.localStorage?$r.exports=nt.localStorage:typeof window!="undefined"&&window.localStorage?$r.exports=window.localStorage:$r.exports=new e})();var Ns={},kr={};Object.defineProperty(kr,"__esModule",{value:!0});kr.IKeyValueStorage=void 0;class tc{}kr.IKeyValueStorage=tc;var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.parseEntry=void 0;const rc=br;function ic(r){var e;return[r[0],rc.safeJsonParse((e=r[1])!==null&&e!==void 0?e:"")]}Yr.parseEntry=ic;(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Ki.exports;e.__exportStar(kr,r),e.__exportStar(Yr,r)})(Ns);Object.defineProperty(Wr,"__esModule",{value:!0});Wr.KeyValueStorage=void 0;const Qt=Ki.exports,Sn=br,nc=Qt.__importDefault($r.exports),sc=Ns;class Cs{constructor(){this.localStorage=nc.default}getKeys(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(sc.parseEntry)})}getItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return Sn.safeJsonParse(t)})}setItem(e,t){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Sn.safeJsonStringify(t))})}removeItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Wr.KeyValueStorage=Cs;var ac=Wr.default=Cs,wr={},mr={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,c,y,d,g,I,S,A,z,N,T,B,M,K,_,D,b,w,m,s;(function(h){var H=typeof nt=="object"?nt:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(r.exports)));function o(l,f){return l!==H&&(typeof Object.create=="function"?Object.defineProperty(l,"__esModule",{value:!0}):l.__esModule=!0),function(v,p){return l[v]=f?f(v,p):p}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var f in l)l.hasOwnProperty(f)&&(o[f]=l[f])};e=function(o,l){H(o,l);function f(){this.constructor=o}o.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)},t=Object.assign||function(o){for(var l,f=1,v=arguments.length;f<v;f++){l=arguments[f];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(o[p]=l[p])}return o},i=function(o,l){var f={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&l.indexOf(v)<0&&(f[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,v=Object.getOwnPropertySymbols(o);p<v.length;p++)l.indexOf(v[p])<0&&Object.prototype.propertyIsEnumerable.call(o,v[p])&&(f[v[p]]=o[v[p]]);return f},n=function(o,l,f,v){var p=arguments.length,u=p<3?l:v===null?v=Object.getOwnPropertyDescriptor(l,f):v,P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,l,f,v);else for(var R=o.length-1;R>=0;R--)(P=o[R])&&(u=(p<3?P(u):p>3?P(l,f,u):P(l,f))||u);return p>3&&u&&Object.defineProperty(l,f,u),u},c=function(o,l){return function(f,v){l(f,v,o)}},y=function(o,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,l)},d=function(o,l,f,v){function p(u){return u instanceof f?u:new f(function(P){P(u)})}return new(f||(f=Promise))(function(u,P){function R(j){try{O(v.next(j))}catch(q){P(q)}}function $(j){try{O(v.throw(j))}catch(q){P(q)}}function O(j){j.done?u(j.value):p(j.value).then(R,$)}O((v=v.apply(o,l||[])).next())})},g=function(o,l){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},v,p,u,P;return P={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function R(O){return function(j){return $([O,j])}}function $(O){if(v)throw new TypeError("Generator is already executing.");for(;f;)try{if(v=1,p&&(u=O[0]&2?p.return:O[0]?p.throw||((u=p.return)&&u.call(p),0):p.next)&&!(u=u.call(p,O[1])).done)return u;switch(p=0,u&&(O=[O[0]&2,u.value]),O[0]){case 0:case 1:u=O;break;case 4:return f.label++,{value:O[1],done:!1};case 5:f.label++,p=O[1],O=[0];continue;case 7:O=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(O[0]===6||O[0]===2)){f=0;continue}if(O[0]===3&&(!u||O[1]>u[0]&&O[1]<u[3])){f.label=O[1];break}if(O[0]===6&&f.label<u[1]){f.label=u[1],u=O;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(O);break}u[2]&&f.ops.pop(),f.trys.pop();continue}O=l.call(o,f)}catch(j){O=[6,j],p=0}finally{v=u=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},s=function(o,l,f,v){v===void 0&&(v=f),o[v]=l[f]},I=function(o,l){for(var f in o)f!=="default"&&!l.hasOwnProperty(f)&&(l[f]=o[f])},S=function(o){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&o[l],v=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,l){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var v=f.call(o),p,u=[],P;try{for(;(l===void 0||l-- >0)&&!(p=v.next()).done;)u.push(p.value)}catch(R){P={error:R}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(P)throw P.error}}return u},z=function(){for(var o=[],l=0;l<arguments.length;l++)o=o.concat(A(arguments[l]));return o},N=function(){for(var o=0,l=0,f=arguments.length;l<f;l++)o+=arguments[l].length;for(var v=Array(o),p=0,l=0;l<f;l++)for(var u=arguments[l],P=0,R=u.length;P<R;P++,p++)v[p]=u[P];return v},T=function(o){return this instanceof T?(this.v=o,this):new T(o)},B=function(o,l,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f.apply(o,l||[]),p,u=[];return p={},P("next"),P("throw"),P("return"),p[Symbol.asyncIterator]=function(){return this},p;function P(G){v[G]&&(p[G]=function(V){return new Promise(function(Q,Y){u.push([G,V,Q,Y])>1||R(G,V)})})}function R(G,V){try{$(v[G](V))}catch(Q){q(u[0][3],Q)}}function $(G){G.value instanceof T?Promise.resolve(G.value.v).then(O,j):q(u[0][2],G)}function O(G){R("next",G)}function j(G){R("throw",G)}function q(G,V){G(V),u.shift(),u.length&&R(u[0][0],u[0][1])}},M=function(o){var l,f;return l={},v("next"),v("throw",function(p){throw p}),v("return"),l[Symbol.iterator]=function(){return this},l;function v(p,u){l[p]=o[p]?function(P){return(f=!f)?{value:T(o[p](P)),done:p==="return"}:u?u(P):P}:u}},K=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=o[Symbol.asyncIterator],f;return l?l.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),f={},v("next"),v("throw"),v("return"),f[Symbol.asyncIterator]=function(){return this},f);function v(u){f[u]=o[u]&&function(P){return new Promise(function(R,$){P=o[u](P),p(R,$,P.done,P.value)})}}function p(u,P,R,$){Promise.resolve($).then(function(O){u({value:O,done:R})},P)}},_=function(o,l){return Object.defineProperty?Object.defineProperty(o,"raw",{value:l}):o.raw=l,o},D=function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(l[f]=o[f]);return l.default=o,l},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,l){if(!l.has(o))throw new TypeError("attempted to get private field on non-instance");return l.get(o)},m=function(o,l,f){if(!l.has(o))throw new TypeError("attempted to set private field on non-instance");return l.set(o,f),f},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",c),h("__metadata",y),h("__awaiter",d),h("__generator",g),h("__exportStar",I),h("__createBinding",s),h("__values",S),h("__read",A),h("__spread",z),h("__spreadArrays",N),h("__await",T),h("__asyncGenerator",B),h("__asyncDelegator",M),h("__asyncValues",K),h("__makeTemplateObject",_),h("__importStar",D),h("__importDefault",b),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",m)})})(mr);var Jr={},ee={},vr={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,c,y,d,g,I,S,A,z,N,T,B,M,K,_,D,b,w,m,s;(function(h){var H=typeof nt=="object"?nt:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(r.exports)));function o(l,f){return l!==H&&(typeof Object.create=="function"?Object.defineProperty(l,"__esModule",{value:!0}):l.__esModule=!0),function(v,p){return l[v]=f?f(v,p):p}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var f in l)l.hasOwnProperty(f)&&(o[f]=l[f])};e=function(o,l){H(o,l);function f(){this.constructor=o}o.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)},t=Object.assign||function(o){for(var l,f=1,v=arguments.length;f<v;f++){l=arguments[f];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(o[p]=l[p])}return o},i=function(o,l){var f={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&l.indexOf(v)<0&&(f[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,v=Object.getOwnPropertySymbols(o);p<v.length;p++)l.indexOf(v[p])<0&&Object.prototype.propertyIsEnumerable.call(o,v[p])&&(f[v[p]]=o[v[p]]);return f},n=function(o,l,f,v){var p=arguments.length,u=p<3?l:v===null?v=Object.getOwnPropertyDescriptor(l,f):v,P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,l,f,v);else for(var R=o.length-1;R>=0;R--)(P=o[R])&&(u=(p<3?P(u):p>3?P(l,f,u):P(l,f))||u);return p>3&&u&&Object.defineProperty(l,f,u),u},c=function(o,l){return function(f,v){l(f,v,o)}},y=function(o,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,l)},d=function(o,l,f,v){function p(u){return u instanceof f?u:new f(function(P){P(u)})}return new(f||(f=Promise))(function(u,P){function R(j){try{O(v.next(j))}catch(q){P(q)}}function $(j){try{O(v.throw(j))}catch(q){P(q)}}function O(j){j.done?u(j.value):p(j.value).then(R,$)}O((v=v.apply(o,l||[])).next())})},g=function(o,l){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},v,p,u,P;return P={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function R(O){return function(j){return $([O,j])}}function $(O){if(v)throw new TypeError("Generator is already executing.");for(;f;)try{if(v=1,p&&(u=O[0]&2?p.return:O[0]?p.throw||((u=p.return)&&u.call(p),0):p.next)&&!(u=u.call(p,O[1])).done)return u;switch(p=0,u&&(O=[O[0]&2,u.value]),O[0]){case 0:case 1:u=O;break;case 4:return f.label++,{value:O[1],done:!1};case 5:f.label++,p=O[1],O=[0];continue;case 7:O=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(O[0]===6||O[0]===2)){f=0;continue}if(O[0]===3&&(!u||O[1]>u[0]&&O[1]<u[3])){f.label=O[1];break}if(O[0]===6&&f.label<u[1]){f.label=u[1],u=O;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(O);break}u[2]&&f.ops.pop(),f.trys.pop();continue}O=l.call(o,f)}catch(j){O=[6,j],p=0}finally{v=u=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},s=function(o,l,f,v){v===void 0&&(v=f),o[v]=l[f]},I=function(o,l){for(var f in o)f!=="default"&&!l.hasOwnProperty(f)&&(l[f]=o[f])},S=function(o){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&o[l],v=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,l){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var v=f.call(o),p,u=[],P;try{for(;(l===void 0||l-- >0)&&!(p=v.next()).done;)u.push(p.value)}catch(R){P={error:R}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(P)throw P.error}}return u},z=function(){for(var o=[],l=0;l<arguments.length;l++)o=o.concat(A(arguments[l]));return o},N=function(){for(var o=0,l=0,f=arguments.length;l<f;l++)o+=arguments[l].length;for(var v=Array(o),p=0,l=0;l<f;l++)for(var u=arguments[l],P=0,R=u.length;P<R;P++,p++)v[p]=u[P];return v},T=function(o){return this instanceof T?(this.v=o,this):new T(o)},B=function(o,l,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f.apply(o,l||[]),p,u=[];return p={},P("next"),P("throw"),P("return"),p[Symbol.asyncIterator]=function(){return this},p;function P(G){v[G]&&(p[G]=function(V){return new Promise(function(Q,Y){u.push([G,V,Q,Y])>1||R(G,V)})})}function R(G,V){try{$(v[G](V))}catch(Q){q(u[0][3],Q)}}function $(G){G.value instanceof T?Promise.resolve(G.value.v).then(O,j):q(u[0][2],G)}function O(G){R("next",G)}function j(G){R("throw",G)}function q(G,V){G(V),u.shift(),u.length&&R(u[0][0],u[0][1])}},M=function(o){var l,f;return l={},v("next"),v("throw",function(p){throw p}),v("return"),l[Symbol.iterator]=function(){return this},l;function v(p,u){l[p]=o[p]?function(P){return(f=!f)?{value:T(o[p](P)),done:p==="return"}:u?u(P):P}:u}},K=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=o[Symbol.asyncIterator],f;return l?l.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),f={},v("next"),v("throw"),v("return"),f[Symbol.asyncIterator]=function(){return this},f);function v(u){f[u]=o[u]&&function(P){return new Promise(function(R,$){P=o[u](P),p(R,$,P.done,P.value)})}}function p(u,P,R,$){Promise.resolve($).then(function(O){u({value:O,done:R})},P)}},_=function(o,l){return Object.defineProperty?Object.defineProperty(o,"raw",{value:l}):o.raw=l,o},D=function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(l[f]=o[f]);return l.default=o,l},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,l){if(!l.has(o))throw new TypeError("attempted to get private field on non-instance");return l.get(o)},m=function(o,l,f){if(!l.has(o))throw new TypeError("attempted to set private field on non-instance");return l.set(o,f),f},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",c),h("__metadata",y),h("__awaiter",d),h("__generator",g),h("__exportStar",I),h("__createBinding",s),h("__values",S),h("__read",A),h("__spread",z),h("__spreadArrays",N),h("__await",T),h("__asyncGenerator",B),h("__asyncDelegator",M),h("__asyncValues",K),h("__makeTemplateObject",_),h("__importStar",D),h("__importDefault",b),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",m)})})(vr);var Fs={},Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.delay=void 0;function oc(r){return new Promise(e=>{setTimeout(()=>{e(!0)},r)})}Xr.delay=oc;var er={},qi={},tr={};Object.defineProperty(tr,"__esModule",{value:!0});tr.ONE_THOUSAND=tr.ONE_HUNDRED=void 0;tr.ONE_HUNDRED=100;tr.ONE_THOUSAND=1e3;var Rs={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365})(Rs);(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=vr.exports;e.__exportStar(tr,r),e.__exportStar(Rs,r)})(qi);Object.defineProperty(er,"__esModule",{value:!0});er.fromMiliseconds=er.toMiliseconds=void 0;const Us=qi;function cc(r){return r*Us.ONE_THOUSAND}er.toMiliseconds=cc;function uc(r){return Math.floor(r/Us.ONE_THOUSAND)}er.fromMiliseconds=uc;(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=vr.exports;e.__exportStar(Xr,r),e.__exportStar(er,r)})(Fs);var Er={};Object.defineProperty(Er,"__esModule",{value:!0});Er.Watch=void 0;class Ls{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){const t=this.get(e);if(typeof t.elapsed!="undefined")throw new Error(`Watch already stopped for label: ${e}`);const i=Date.now()-t.started;this.timestamps.set(e,{started:t.started,elapsed:i})}get(e){const t=this.timestamps.get(e);if(typeof t=="undefined")throw new Error(`No timestamp found for label: ${e}`);return t}elapsed(e){const t=this.get(e);return t.elapsed||Date.now()-t.started}}Er.Watch=Ls;Er.default=Ls;var Ms={},Zr={};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.IWatch=void 0;class hc{}Zr.IWatch=hc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),vr.exports.__exportStar(Zr,r)})(Ms);(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=vr.exports;e.__exportStar(Fs,r),e.__exportStar(Er,r),e.__exportStar(Ms,r),e.__exportStar(qi,r)})(ee);var Vi={},Qr={};class Gt{}var lc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gt},Symbol.toStringTag,{value:"Module"})),fc=Ro(lc);Object.defineProperty(Qr,"__esModule",{value:!0});Qr.IHeartBeat=void 0;const dc=fc;class pc extends dc.IEvents{constructor(e){super()}}Qr.IHeartBeat=pc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),mr.exports.__exportStar(Qr,r)})(Vi);var Gi={},rr={};Object.defineProperty(rr,"__esModule",{value:!0});rr.HEARTBEAT_EVENTS=rr.HEARTBEAT_INTERVAL=void 0;const gc=ee;rr.HEARTBEAT_INTERVAL=gc.FIVE_SECONDS;rr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),mr.exports.__exportStar(rr,r)})(Gi);Object.defineProperty(Jr,"__esModule",{value:!0});Jr.HeartBeat=void 0;const li=mr.exports,yc=Tt.exports,_c=ee,bc=Vi,fi=Gi;class Wi extends bc.IHeartBeat{constructor(e){super(e),this.events=new yc.EventEmitter,this.interval=fi.HEARTBEAT_INTERVAL,this.interval=(e==null?void 0:e.interval)||fi.HEARTBEAT_INTERVAL}static init(e){return li.__awaiter(this,void 0,void 0,function*(){const t=new Wi(e);return yield t.init(),t})}init(){return li.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return li.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),_c.toMiliseconds(this.interval))})}pulse(){this.events.emit(fi.HEARTBEAT_EVENTS.pulse)}}Jr.HeartBeat=Wi;(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=mr.exports;e.__exportStar(Jr,r),e.__exportStar(Vi,r),e.__exportStar(Gi,r)})(wr);var Se={},js={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,c,y,d,g,I,S,A,z,N,T,B,M,K,_,D,b,w,m,s;(function(h){var H=typeof nt=="object"?nt:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(r.exports)));function o(l,f){return l!==H&&(typeof Object.create=="function"?Object.defineProperty(l,"__esModule",{value:!0}):l.__esModule=!0),function(v,p){return l[v]=f?f(v,p):p}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var f in l)l.hasOwnProperty(f)&&(o[f]=l[f])};e=function(o,l){H(o,l);function f(){this.constructor=o}o.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)},t=Object.assign||function(o){for(var l,f=1,v=arguments.length;f<v;f++){l=arguments[f];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(o[p]=l[p])}return o},i=function(o,l){var f={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&l.indexOf(v)<0&&(f[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,v=Object.getOwnPropertySymbols(o);p<v.length;p++)l.indexOf(v[p])<0&&Object.prototype.propertyIsEnumerable.call(o,v[p])&&(f[v[p]]=o[v[p]]);return f},n=function(o,l,f,v){var p=arguments.length,u=p<3?l:v===null?v=Object.getOwnPropertyDescriptor(l,f):v,P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,l,f,v);else for(var R=o.length-1;R>=0;R--)(P=o[R])&&(u=(p<3?P(u):p>3?P(l,f,u):P(l,f))||u);return p>3&&u&&Object.defineProperty(l,f,u),u},c=function(o,l){return function(f,v){l(f,v,o)}},y=function(o,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,l)},d=function(o,l,f,v){function p(u){return u instanceof f?u:new f(function(P){P(u)})}return new(f||(f=Promise))(function(u,P){function R(j){try{O(v.next(j))}catch(q){P(q)}}function $(j){try{O(v.throw(j))}catch(q){P(q)}}function O(j){j.done?u(j.value):p(j.value).then(R,$)}O((v=v.apply(o,l||[])).next())})},g=function(o,l){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},v,p,u,P;return P={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function R(O){return function(j){return $([O,j])}}function $(O){if(v)throw new TypeError("Generator is already executing.");for(;f;)try{if(v=1,p&&(u=O[0]&2?p.return:O[0]?p.throw||((u=p.return)&&u.call(p),0):p.next)&&!(u=u.call(p,O[1])).done)return u;switch(p=0,u&&(O=[O[0]&2,u.value]),O[0]){case 0:case 1:u=O;break;case 4:return f.label++,{value:O[1],done:!1};case 5:f.label++,p=O[1],O=[0];continue;case 7:O=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(O[0]===6||O[0]===2)){f=0;continue}if(O[0]===3&&(!u||O[1]>u[0]&&O[1]<u[3])){f.label=O[1];break}if(O[0]===6&&f.label<u[1]){f.label=u[1],u=O;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(O);break}u[2]&&f.ops.pop(),f.trys.pop();continue}O=l.call(o,f)}catch(j){O=[6,j],p=0}finally{v=u=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},s=function(o,l,f,v){v===void 0&&(v=f),o[v]=l[f]},I=function(o,l){for(var f in o)f!=="default"&&!l.hasOwnProperty(f)&&(l[f]=o[f])},S=function(o){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&o[l],v=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,l){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var v=f.call(o),p,u=[],P;try{for(;(l===void 0||l-- >0)&&!(p=v.next()).done;)u.push(p.value)}catch(R){P={error:R}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(P)throw P.error}}return u},z=function(){for(var o=[],l=0;l<arguments.length;l++)o=o.concat(A(arguments[l]));return o},N=function(){for(var o=0,l=0,f=arguments.length;l<f;l++)o+=arguments[l].length;for(var v=Array(o),p=0,l=0;l<f;l++)for(var u=arguments[l],P=0,R=u.length;P<R;P++,p++)v[p]=u[P];return v},T=function(o){return this instanceof T?(this.v=o,this):new T(o)},B=function(o,l,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=f.apply(o,l||[]),p,u=[];return p={},P("next"),P("throw"),P("return"),p[Symbol.asyncIterator]=function(){return this},p;function P(G){v[G]&&(p[G]=function(V){return new Promise(function(Q,Y){u.push([G,V,Q,Y])>1||R(G,V)})})}function R(G,V){try{$(v[G](V))}catch(Q){q(u[0][3],Q)}}function $(G){G.value instanceof T?Promise.resolve(G.value.v).then(O,j):q(u[0][2],G)}function O(G){R("next",G)}function j(G){R("throw",G)}function q(G,V){G(V),u.shift(),u.length&&R(u[0][0],u[0][1])}},M=function(o){var l,f;return l={},v("next"),v("throw",function(p){throw p}),v("return"),l[Symbol.iterator]=function(){return this},l;function v(p,u){l[p]=o[p]?function(P){return(f=!f)?{value:T(o[p](P)),done:p==="return"}:u?u(P):P}:u}},K=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=o[Symbol.asyncIterator],f;return l?l.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),f={},v("next"),v("throw"),v("return"),f[Symbol.asyncIterator]=function(){return this},f);function v(u){f[u]=o[u]&&function(P){return new Promise(function(R,$){P=o[u](P),p(R,$,P.done,P.value)})}}function p(u,P,R,$){Promise.resolve($).then(function(O){u({value:O,done:R})},P)}},_=function(o,l){return Object.defineProperty?Object.defineProperty(o,"raw",{value:l}):o.raw=l,o},D=function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(l[f]=o[f]);return l.default=o,l},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,l){if(!l.has(o))throw new TypeError("attempted to get private field on non-instance");return l.get(o)},m=function(o,l,f){if(!l.has(o))throw new TypeError("attempted to set private field on non-instance");return l.set(o,f),f},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",c),h("__metadata",y),h("__awaiter",d),h("__generator",g),h("__exportStar",I),h("__createBinding",s),h("__values",S),h("__read",A),h("__spread",z),h("__spreadArrays",N),h("__await",T),h("__asyncGenerator",B),h("__asyncDelegator",M),h("__asyncValues",K),h("__makeTemplateObject",_),h("__importStar",D),h("__importDefault",b),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",m)})})(js);var Vt={};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.PINO_CUSTOM_CONTEXT_KEY=Vt.PINO_LOGGER_DEFAULTS=void 0;Vt.PINO_LOGGER_DEFAULTS={level:"info"};Vt.PINO_CUSTOM_CONTEXT_KEY="custom_context";var at={};Object.defineProperty(at,"__esModule",{value:!0});at.generateChildLogger=at.formatChildLoggerContext=at.getLoggerContext=at.setBrowserLoggerContext=at.getBrowserLoggerContext=at.getDefaultLoggerOptions=void 0;const ir=Vt;function wc(r){return Object.assign(Object.assign({},r),{level:(r==null?void 0:r.level)||ir.PINO_LOGGER_DEFAULTS.level})}at.getDefaultLoggerOptions=wc;function $s(r,e=ir.PINO_CUSTOM_CONTEXT_KEY){return r[e]||""}at.getBrowserLoggerContext=$s;function zs(r,e,t=ir.PINO_CUSTOM_CONTEXT_KEY){return r[t]=e,r}at.setBrowserLoggerContext=zs;function Hs(r,e=ir.PINO_CUSTOM_CONTEXT_KEY){let t="";return typeof r.bindings=="undefined"?t=$s(r,e):t=r.bindings().context||"",t}at.getLoggerContext=Hs;function Bs(r,e,t=ir.PINO_CUSTOM_CONTEXT_KEY){const i=Hs(r,t);return i.trim()?`${i}/${e}`:e}at.formatChildLoggerContext=Bs;function mc(r,e,t=ir.PINO_CUSTOM_CONTEXT_KEY){const i=Bs(r,e,t),n=r.child({context:i});return zs(n,i,t)}at.generateChildLogger=mc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.pino=void 0;const e=js.exports,t=e.__importDefault(_r);Object.defineProperty(r,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Vt,r),e.__exportStar(at,r)})(Se);class vc extends Gt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class Ec extends Gt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}}class Dc{constructor(e,t){this.logger=e,this.core=t}}class Sc extends Gt{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Oc extends Gt{constructor(e){super()}}class Ic{constructor(e,t,i,n){this.core=e,this.logger=t,this.name=i}}class xc extends Gt{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Pc extends Gt{constructor(e,t){super(),this.core=e,this.logger=t}}class Tc{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Ac{constructor(e){this.client=e}}var ki={},nr={},ei={},ti={};Object.defineProperty(ti,"__esModule",{value:!0});ti.BrowserRandomSource=void 0;const On=65536;class Nc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self!="undefined"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let i=0;i<t.length;i+=On)this._crypto.getRandomValues(t.subarray(i,i+Math.min(t.length-i,On)));return t}}ti.BrowserRandomSource=Nc;var ri={},ft={};Object.defineProperty(ft,"__esModule",{value:!0});function Cc(r){for(var e=0;e<r.length;e++)r[e]=0;return r}ft.wipe=Cc;Object.defineProperty(ri,"__esModule",{value:!0});ri.NodeRandomSource=void 0;const Fc=ft;class Rc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Uo!="undefined"){const e=$o;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=t[n];return(0,Fc.wipe)(t),i}}ri.NodeRandomSource=Rc;Object.defineProperty(ei,"__esModule",{value:!0});ei.SystemRandomSource=void 0;const Uc=ti,Lc=ri;class Mc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Uc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Lc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}ei.SystemRandomSource=Mc;var ie={},Ks={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});function e(d,g){var I=d>>>16&65535,S=d&65535,A=g>>>16&65535,z=g&65535;return S*z+(I*z+S*A<<16>>>0)|0}r.mul=Math.imul||e;function t(d,g){return d+g|0}r.add=t;function i(d,g){return d-g|0}r.sub=i;function n(d,g){return d<<g|d>>>32-g}r.rotl=n;function c(d,g){return d<<32-g|d>>>g}r.rotr=c;function y(d){return typeof d=="number"&&isFinite(d)&&Math.floor(d)===d}r.isInteger=Number.isInteger||y,r.MAX_SAFE_INTEGER=9007199254740991,r.isSafeInteger=function(d){return r.isInteger(d)&&d>=-r.MAX_SAFE_INTEGER&&d<=r.MAX_SAFE_INTEGER}})(Ks);Object.defineProperty(ie,"__esModule",{value:!0});var qs=Ks;function jc(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}ie.readInt16BE=jc;function $c(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}ie.readUint16BE=$c;function zc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}ie.readInt16LE=zc;function Hc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}ie.readUint16LE=Hc;function Vs(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}ie.writeUint16BE=Vs;ie.writeInt16BE=Vs;function Gs(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}ie.writeUint16LE=Gs;ie.writeInt16LE=Gs;function mi(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}ie.readInt32BE=mi;function vi(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}ie.readUint32BE=vi;function Ei(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}ie.readInt32LE=Ei;function Di(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}ie.readUint32LE=Di;function Hr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}ie.writeUint32BE=Hr;ie.writeInt32BE=Hr;function Br(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}ie.writeUint32LE=Br;ie.writeInt32LE=Br;function Bc(r,e){e===void 0&&(e=0);var t=mi(r,e),i=mi(r,e+4);return t*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=Bc;function Kc(r,e){e===void 0&&(e=0);var t=vi(r,e),i=vi(r,e+4);return t*4294967296+i}ie.readUint64BE=Kc;function qc(r,e){e===void 0&&(e=0);var t=Ei(r,e),i=Ei(r,e+4);return i*4294967296+t-(t>>31)*4294967296}ie.readInt64LE=qc;function Vc(r,e){e===void 0&&(e=0);var t=Di(r,e),i=Di(r,e+4);return i*4294967296+t}ie.readUint64LE=Vc;function Ws(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Hr(r/4294967296>>>0,e,t),Hr(r>>>0,e,t+4),e}ie.writeUint64BE=Ws;ie.writeInt64BE=Ws;function ks(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Br(r>>>0,e,t),Br(r/4294967296>>>0,e,t+4),e}ie.writeUint64LE=ks;ie.writeInt64LE=ks;function Gc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,c=r/8+t-1;c>=t;c--)i+=e[c]*n,n*=256;return i}ie.readUintBE=Gc;function Wc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,c=t;c<t+r/8;c++)i+=e[c]*n,n*=256;return i}ie.readUintLE=Wc;function kc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!qs.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,c=r/8+i-1;c>=i;c--)t[c]=e/n&255,n*=256;return t}ie.writeUintBE=kc;function Yc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!qs.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,c=i;c<i+r/8;c++)t[c]=e/n&255,n*=256;return t}ie.writeUintLE=Yc;function Jc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}ie.readFloat32BE=Jc;function Xc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}ie.readFloat32LE=Xc;function Zc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}ie.readFloat64BE=Zc;function Qc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}ie.readFloat64LE=Qc;function eu(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r),e}ie.writeFloat32BE=eu;function tu(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r,!0),e}ie.writeFloat32LE=tu;function ru(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r),e}ie.writeFloat64BE=ru;function iu(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r,!0),e}ie.writeFloat64LE=iu;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.randomStringForEntropy=r.randomString=r.randomUint32=r.randomBytes=r.defaultRandomSource=void 0;const e=ei,t=ie,i=ft;r.defaultRandomSource=new e.SystemRandomSource;function n(I,S=r.defaultRandomSource){return S.randomBytes(I)}r.randomBytes=n;function c(I=r.defaultRandomSource){const S=n(4,I),A=(0,t.readUint32LE)(S);return(0,i.wipe)(S),A}r.randomUint32=c;const y="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function d(I,S=y,A=r.defaultRandomSource){if(S.length<2)throw new Error("randomString charset is too short");if(S.length>256)throw new Error("randomString charset is too long");let z="";const N=S.length,T=256-256%N;for(;I>0;){const B=n(Math.ceil(I*256/T),A);for(let M=0;M<B.length&&I>0;M++){const K=B[M];K<T&&(z+=S.charAt(K%N),I--)}(0,i.wipe)(B)}return z}r.randomString=d;function g(I,S=y,A=r.defaultRandomSource){const z=Math.ceil(I/(Math.log(S.length)/Math.LN2));return d(z,S,A)}r.randomStringForEntropy=g})(nr);var Ys={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=ie,t=ft;r.DIGEST_LENGTH=64,r.BLOCK_SIZE=128;var i=function(){function d(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return d.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},d.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},d.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},d.prototype.update=function(g,I){if(I===void 0&&(I=g.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var S=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<r.BLOCK_SIZE&&I>0;)this._buffer[this._bufferLength++]=g[S++],I--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(S=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,g,S,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=g[S++],I--;return this},d.prototype.finish=function(g){if(!this._finished){var I=this._bytesHashed,S=this._bufferLength,A=I/536870912|0,z=I<<3,N=I%128<112?128:256;this._buffer[S]=128;for(var T=S+1;T<N-8;T++)this._buffer[T]=0;e.writeUint32BE(A,this._buffer,N-8),e.writeUint32BE(z,this._buffer,N-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var T=0;T<this.digestLength/8;T++)e.writeUint32BE(this._stateHi[T],g,T*8),e.writeUint32BE(this._stateLo[T],g,T*8+4);return this},d.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},d.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},d.prototype.restoreState=function(g){return this._stateHi.set(g.stateHi),this._stateLo.set(g.stateLo),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},d.prototype.cleanSavedState=function(g){t.wipe(g.stateHi),t.wipe(g.stateLo),g.buffer&&t.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},d}();r.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(d,g,I,S,A,z,N){for(var T=I[0],B=I[1],M=I[2],K=I[3],_=I[4],D=I[5],b=I[6],w=I[7],m=S[0],s=S[1],h=S[2],H=S[3],o=S[4],l=S[5],f=S[6],v=S[7],p,u,P,R,$,O,j,q;N>=128;){for(var G=0;G<16;G++){var V=8*G+z;d[G]=e.readUint32BE(A,V),g[G]=e.readUint32BE(A,V+4)}for(var G=0;G<80;G++){var Q=T,Y=B,oe=M,L=K,U=_,C=D,a=b,x=w,k=m,X=s,le=h,_e=H,de=o,me=l,Re=f,Ae=v;if(p=w,u=v,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=(_>>>14|o<<32-14)^(_>>>18|o<<32-18)^(o>>>41-32|_<<32-(41-32)),u=(o>>>14|_<<32-14)^(o>>>18|_<<32-18)^(_>>>41-32|o<<32-(41-32)),$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,p=_&D^~_&b,u=o&l^~o&f,$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,p=n[G*2],u=n[G*2+1],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,p=d[G%16],u=g[G%16],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,P=j&65535|q<<16,R=$&65535|O<<16,p=P,u=R,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=(T>>>28|m<<32-28)^(m>>>34-32|T<<32-(34-32))^(m>>>39-32|T<<32-(39-32)),u=(m>>>28|T<<32-28)^(T>>>34-32|m<<32-(34-32))^(T>>>39-32|m<<32-(39-32)),$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,p=T&B^T&M^B&M,u=m&s^m&h^s&h,$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,x=j&65535|q<<16,Ae=$&65535|O<<16,p=L,u=_e,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=P,u=R,$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,L=j&65535|q<<16,_e=$&65535|O<<16,B=Q,M=Y,K=oe,_=L,D=U,b=C,w=a,T=x,s=k,h=X,H=le,o=_e,l=de,f=me,v=Re,m=Ae,G%16===15)for(var V=0;V<16;V++)p=d[V],u=g[V],$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=d[(V+9)%16],u=g[(V+9)%16],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,P=d[(V+1)%16],R=g[(V+1)%16],p=(P>>>1|R<<32-1)^(P>>>8|R<<32-8)^P>>>7,u=(R>>>1|P<<32-1)^(R>>>8|P<<32-8)^(R>>>7|P<<32-7),$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,P=d[(V+14)%16],R=g[(V+14)%16],p=(P>>>19|R<<32-19)^(R>>>61-32|P<<32-(61-32))^P>>>6,u=(R>>>19|P<<32-19)^(P>>>61-32|R<<32-(61-32))^(R>>>6|P<<32-6),$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,d[V]=j&65535|q<<16,g[V]=$&65535|O<<16}p=T,u=m,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[0],u=S[0],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[0]=T=j&65535|q<<16,S[0]=m=$&65535|O<<16,p=B,u=s,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[1],u=S[1],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[1]=B=j&65535|q<<16,S[1]=s=$&65535|O<<16,p=M,u=h,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[2],u=S[2],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[2]=M=j&65535|q<<16,S[2]=h=$&65535|O<<16,p=K,u=H,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[3],u=S[3],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[3]=K=j&65535|q<<16,S[3]=H=$&65535|O<<16,p=_,u=o,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[4],u=S[4],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[4]=_=j&65535|q<<16,S[4]=o=$&65535|O<<16,p=D,u=l,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[5],u=S[5],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[5]=D=j&65535|q<<16,S[5]=l=$&65535|O<<16,p=b,u=f,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[6],u=S[6],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[6]=b=j&65535|q<<16,S[6]=f=$&65535|O<<16,p=w,u=v,$=u&65535,O=u>>>16,j=p&65535,q=p>>>16,p=I[7],u=S[7],$+=u&65535,O+=u>>>16,j+=p&65535,q+=p>>>16,O+=$>>>16,j+=O>>>16,q+=j>>>16,I[7]=w=j&65535|q<<16,S[7]=v=$&65535|O<<16,z+=128,N-=128}return z}function y(d){var g=new i;g.update(d);var I=g.digest();return g.clean(),I}r.hash=y})(Ys);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertSecretKeyToX25519=r.convertPublicKeyToX25519=r.verify=r.sign=r.extractPublicKeyFromSecretKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.SEED_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=r.SIGNATURE_LENGTH=void 0;const e=nr,t=Ys,i=ft;r.SIGNATURE_LENGTH=64,r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=64,r.SEED_LENGTH=32;function n(L){const U=new Float64Array(16);if(L)for(let C=0;C<L.length;C++)U[C]=L[C];return U}const c=new Uint8Array(32);c[0]=9;const y=n(),d=n([1]),g=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),I=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),S=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),A=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),z=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N(L,U){for(let C=0;C<16;C++)L[C]=U[C]|0}function T(L){let U=1;for(let C=0;C<16;C++){let a=L[C]+U+65535;U=Math.floor(a/65536),L[C]=a-U*65536}L[0]+=U-1+37*(U-1)}function B(L,U,C){const a=~(C-1);for(let x=0;x<16;x++){const k=a&(L[x]^U[x]);L[x]^=k,U[x]^=k}}function M(L,U){const C=n(),a=n();for(let x=0;x<16;x++)a[x]=U[x];T(a),T(a),T(a);for(let x=0;x<2;x++){C[0]=a[0]-65517;for(let X=1;X<15;X++)C[X]=a[X]-65535-(C[X-1]>>16&1),C[X-1]&=65535;C[15]=a[15]-32767-(C[14]>>16&1);const k=C[15]>>16&1;C[14]&=65535,B(a,C,1-k)}for(let x=0;x<16;x++)L[2*x]=a[x]&255,L[2*x+1]=a[x]>>8}function K(L,U){let C=0;for(let a=0;a<32;a++)C|=L[a]^U[a];return(1&C-1>>>8)-1}function _(L,U){const C=new Uint8Array(32),a=new Uint8Array(32);return M(C,L),M(a,U),K(C,a)}function D(L){const U=new Uint8Array(32);return M(U,L),U[0]&1}function b(L,U){for(let C=0;C<16;C++)L[C]=U[2*C]+(U[2*C+1]<<8);L[15]&=32767}function w(L,U,C){for(let a=0;a<16;a++)L[a]=U[a]+C[a]}function m(L,U,C){for(let a=0;a<16;a++)L[a]=U[a]-C[a]}function s(L,U,C){let a,x,k=0,X=0,le=0,_e=0,de=0,me=0,Re=0,Ae=0,ye=0,pe=0,fe=0,ue=0,ce=0,ae=0,se=0,te=0,he=0,ge=0,re=0,be=0,we=0,Ee=0,De=0,ve=0,_t=0,wt=0,At=0,ht=0,zt=0,or=0,Pr=0,Le=C[0],Ne=C[1],Me=C[2],je=C[3],$e=C[4],Ce=C[5],Be=C[6],Ke=C[7],qe=C[8],Ve=C[9],Ge=C[10],He=C[11],ze=C[12],Pe=C[13],We=C[14],ke=C[15];a=U[0],k+=a*Le,X+=a*Ne,le+=a*Me,_e+=a*je,de+=a*$e,me+=a*Ce,Re+=a*Be,Ae+=a*Ke,ye+=a*qe,pe+=a*Ve,fe+=a*Ge,ue+=a*He,ce+=a*ze,ae+=a*Pe,se+=a*We,te+=a*ke,a=U[1],X+=a*Le,le+=a*Ne,_e+=a*Me,de+=a*je,me+=a*$e,Re+=a*Ce,Ae+=a*Be,ye+=a*Ke,pe+=a*qe,fe+=a*Ve,ue+=a*Ge,ce+=a*He,ae+=a*ze,se+=a*Pe,te+=a*We,he+=a*ke,a=U[2],le+=a*Le,_e+=a*Ne,de+=a*Me,me+=a*je,Re+=a*$e,Ae+=a*Ce,ye+=a*Be,pe+=a*Ke,fe+=a*qe,ue+=a*Ve,ce+=a*Ge,ae+=a*He,se+=a*ze,te+=a*Pe,he+=a*We,ge+=a*ke,a=U[3],_e+=a*Le,de+=a*Ne,me+=a*Me,Re+=a*je,Ae+=a*$e,ye+=a*Ce,pe+=a*Be,fe+=a*Ke,ue+=a*qe,ce+=a*Ve,ae+=a*Ge,se+=a*He,te+=a*ze,he+=a*Pe,ge+=a*We,re+=a*ke,a=U[4],de+=a*Le,me+=a*Ne,Re+=a*Me,Ae+=a*je,ye+=a*$e,pe+=a*Ce,fe+=a*Be,ue+=a*Ke,ce+=a*qe,ae+=a*Ve,se+=a*Ge,te+=a*He,he+=a*ze,ge+=a*Pe,re+=a*We,be+=a*ke,a=U[5],me+=a*Le,Re+=a*Ne,Ae+=a*Me,ye+=a*je,pe+=a*$e,fe+=a*Ce,ue+=a*Be,ce+=a*Ke,ae+=a*qe,se+=a*Ve,te+=a*Ge,he+=a*He,ge+=a*ze,re+=a*Pe,be+=a*We,we+=a*ke,a=U[6],Re+=a*Le,Ae+=a*Ne,ye+=a*Me,pe+=a*je,fe+=a*$e,ue+=a*Ce,ce+=a*Be,ae+=a*Ke,se+=a*qe,te+=a*Ve,he+=a*Ge,ge+=a*He,re+=a*ze,be+=a*Pe,we+=a*We,Ee+=a*ke,a=U[7],Ae+=a*Le,ye+=a*Ne,pe+=a*Me,fe+=a*je,ue+=a*$e,ce+=a*Ce,ae+=a*Be,se+=a*Ke,te+=a*qe,he+=a*Ve,ge+=a*Ge,re+=a*He,be+=a*ze,we+=a*Pe,Ee+=a*We,De+=a*ke,a=U[8],ye+=a*Le,pe+=a*Ne,fe+=a*Me,ue+=a*je,ce+=a*$e,ae+=a*Ce,se+=a*Be,te+=a*Ke,he+=a*qe,ge+=a*Ve,re+=a*Ge,be+=a*He,we+=a*ze,Ee+=a*Pe,De+=a*We,ve+=a*ke,a=U[9],pe+=a*Le,fe+=a*Ne,ue+=a*Me,ce+=a*je,ae+=a*$e,se+=a*Ce,te+=a*Be,he+=a*Ke,ge+=a*qe,re+=a*Ve,be+=a*Ge,we+=a*He,Ee+=a*ze,De+=a*Pe,ve+=a*We,_t+=a*ke,a=U[10],fe+=a*Le,ue+=a*Ne,ce+=a*Me,ae+=a*je,se+=a*$e,te+=a*Ce,he+=a*Be,ge+=a*Ke,re+=a*qe,be+=a*Ve,we+=a*Ge,Ee+=a*He,De+=a*ze,ve+=a*Pe,_t+=a*We,wt+=a*ke,a=U[11],ue+=a*Le,ce+=a*Ne,ae+=a*Me,se+=a*je,te+=a*$e,he+=a*Ce,ge+=a*Be,re+=a*Ke,be+=a*qe,we+=a*Ve,Ee+=a*Ge,De+=a*He,ve+=a*ze,_t+=a*Pe,wt+=a*We,At+=a*ke,a=U[12],ce+=a*Le,ae+=a*Ne,se+=a*Me,te+=a*je,he+=a*$e,ge+=a*Ce,re+=a*Be,be+=a*Ke,we+=a*qe,Ee+=a*Ve,De+=a*Ge,ve+=a*He,_t+=a*ze,wt+=a*Pe,At+=a*We,ht+=a*ke,a=U[13],ae+=a*Le,se+=a*Ne,te+=a*Me,he+=a*je,ge+=a*$e,re+=a*Ce,be+=a*Be,we+=a*Ke,Ee+=a*qe,De+=a*Ve,ve+=a*Ge,_t+=a*He,wt+=a*ze,At+=a*Pe,ht+=a*We,zt+=a*ke,a=U[14],se+=a*Le,te+=a*Ne,he+=a*Me,ge+=a*je,re+=a*$e,be+=a*Ce,we+=a*Be,Ee+=a*Ke,De+=a*qe,ve+=a*Ve,_t+=a*Ge,wt+=a*He,At+=a*ze,ht+=a*Pe,zt+=a*We,or+=a*ke,a=U[15],te+=a*Le,he+=a*Ne,ge+=a*Me,re+=a*je,be+=a*$e,we+=a*Ce,Ee+=a*Be,De+=a*Ke,ve+=a*qe,_t+=a*Ve,wt+=a*Ge,At+=a*He,ht+=a*ze,zt+=a*Pe,or+=a*We,Pr+=a*ke,k+=38*he,X+=38*ge,le+=38*re,_e+=38*be,de+=38*we,me+=38*Ee,Re+=38*De,Ae+=38*ve,ye+=38*_t,pe+=38*wt,fe+=38*At,ue+=38*ht,ce+=38*zt,ae+=38*or,se+=38*Pr,x=1,a=k+x+65535,x=Math.floor(a/65536),k=a-x*65536,a=X+x+65535,x=Math.floor(a/65536),X=a-x*65536,a=le+x+65535,x=Math.floor(a/65536),le=a-x*65536,a=_e+x+65535,x=Math.floor(a/65536),_e=a-x*65536,a=de+x+65535,x=Math.floor(a/65536),de=a-x*65536,a=me+x+65535,x=Math.floor(a/65536),me=a-x*65536,a=Re+x+65535,x=Math.floor(a/65536),Re=a-x*65536,a=Ae+x+65535,x=Math.floor(a/65536),Ae=a-x*65536,a=ye+x+65535,x=Math.floor(a/65536),ye=a-x*65536,a=pe+x+65535,x=Math.floor(a/65536),pe=a-x*65536,a=fe+x+65535,x=Math.floor(a/65536),fe=a-x*65536,a=ue+x+65535,x=Math.floor(a/65536),ue=a-x*65536,a=ce+x+65535,x=Math.floor(a/65536),ce=a-x*65536,a=ae+x+65535,x=Math.floor(a/65536),ae=a-x*65536,a=se+x+65535,x=Math.floor(a/65536),se=a-x*65536,a=te+x+65535,x=Math.floor(a/65536),te=a-x*65536,k+=x-1+37*(x-1),x=1,a=k+x+65535,x=Math.floor(a/65536),k=a-x*65536,a=X+x+65535,x=Math.floor(a/65536),X=a-x*65536,a=le+x+65535,x=Math.floor(a/65536),le=a-x*65536,a=_e+x+65535,x=Math.floor(a/65536),_e=a-x*65536,a=de+x+65535,x=Math.floor(a/65536),de=a-x*65536,a=me+x+65535,x=Math.floor(a/65536),me=a-x*65536,a=Re+x+65535,x=Math.floor(a/65536),Re=a-x*65536,a=Ae+x+65535,x=Math.floor(a/65536),Ae=a-x*65536,a=ye+x+65535,x=Math.floor(a/65536),ye=a-x*65536,a=pe+x+65535,x=Math.floor(a/65536),pe=a-x*65536,a=fe+x+65535,x=Math.floor(a/65536),fe=a-x*65536,a=ue+x+65535,x=Math.floor(a/65536),ue=a-x*65536,a=ce+x+65535,x=Math.floor(a/65536),ce=a-x*65536,a=ae+x+65535,x=Math.floor(a/65536),ae=a-x*65536,a=se+x+65535,x=Math.floor(a/65536),se=a-x*65536,a=te+x+65535,x=Math.floor(a/65536),te=a-x*65536,k+=x-1+37*(x-1),L[0]=k,L[1]=X,L[2]=le,L[3]=_e,L[4]=de,L[5]=me,L[6]=Re,L[7]=Ae,L[8]=ye,L[9]=pe,L[10]=fe,L[11]=ue,L[12]=ce,L[13]=ae,L[14]=se,L[15]=te}function h(L,U){s(L,U,U)}function H(L,U){const C=n();let a;for(a=0;a<16;a++)C[a]=U[a];for(a=253;a>=0;a--)h(C,C),a!==2&&a!==4&&s(C,C,U);for(a=0;a<16;a++)L[a]=C[a]}function o(L,U){const C=n();let a;for(a=0;a<16;a++)C[a]=U[a];for(a=250;a>=0;a--)h(C,C),a!==1&&s(C,C,U);for(a=0;a<16;a++)L[a]=C[a]}function l(L,U){const C=n(),a=n(),x=n(),k=n(),X=n(),le=n(),_e=n(),de=n(),me=n();m(C,L[1],L[0]),m(me,U[1],U[0]),s(C,C,me),w(a,L[0],L[1]),w(me,U[0],U[1]),s(a,a,me),s(x,L[3],U[3]),s(x,x,I),s(k,L[2],U[2]),w(k,k,k),m(X,a,C),m(le,k,x),w(_e,k,x),w(de,a,C),s(L[0],X,le),s(L[1],de,_e),s(L[2],_e,le),s(L[3],X,de)}function f(L,U,C){for(let a=0;a<4;a++)B(L[a],U[a],C)}function v(L,U){const C=n(),a=n(),x=n();H(x,U[2]),s(C,U[0],x),s(a,U[1],x),M(L,a),L[31]^=D(C)<<7}function p(L,U,C){N(L[0],y),N(L[1],d),N(L[2],d),N(L[3],y);for(let a=255;a>=0;--a){const x=C[a/8|0]>>(a&7)&1;f(L,U,x),l(U,L),l(L,L),f(L,U,x)}}function u(L,U){const C=[n(),n(),n(),n()];N(C[0],S),N(C[1],A),N(C[2],d),s(C[3],S,A),p(L,C,U)}function P(L){if(L.length!==r.SEED_LENGTH)throw new Error(`ed25519: seed must be ${r.SEED_LENGTH} bytes`);const U=(0,t.hash)(L);U[0]&=248,U[31]&=127,U[31]|=64;const C=new Uint8Array(32),a=[n(),n(),n(),n()];u(a,U),v(C,a);const x=new Uint8Array(64);return x.set(L),x.set(C,32),{publicKey:C,secretKey:x}}r.generateKeyPairFromSeed=P;function R(L){const U=(0,e.randomBytes)(32,L),C=P(U);return(0,i.wipe)(U),C}r.generateKeyPair=R;function $(L){if(L.length!==r.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${r.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(L.subarray(32))}r.extractPublicKeyFromSecretKey=$;const O=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function j(L,U){let C,a,x,k;for(a=63;a>=32;--a){for(C=0,x=a-32,k=a-12;x<k;++x)U[x]+=C-16*U[a]*O[x-(a-32)],C=Math.floor((U[x]+128)/256),U[x]-=C*256;U[x]+=C,U[a]=0}for(C=0,x=0;x<32;x++)U[x]+=C-(U[31]>>4)*O[x],C=U[x]>>8,U[x]&=255;for(x=0;x<32;x++)U[x]-=C*O[x];for(a=0;a<32;a++)U[a+1]+=U[a]>>8,L[a]=U[a]&255}function q(L){const U=new Float64Array(64);for(let C=0;C<64;C++)U[C]=L[C];for(let C=0;C<64;C++)L[C]=0;j(L,U)}function G(L,U){const C=new Float64Array(64),a=[n(),n(),n(),n()],x=(0,t.hash)(L.subarray(0,32));x[0]&=248,x[31]&=127,x[31]|=64;const k=new Uint8Array(64);k.set(x.subarray(32),32);const X=new t.SHA512;X.update(k.subarray(32)),X.update(U);const le=X.digest();X.clean(),q(le),u(a,le),v(k,a),X.reset(),X.update(k.subarray(0,32)),X.update(L.subarray(32)),X.update(U);const _e=X.digest();q(_e);for(let de=0;de<32;de++)C[de]=le[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)C[de+me]+=_e[de]*x[me];return j(k.subarray(32),C),k}r.sign=G;function V(L,U){const C=n(),a=n(),x=n(),k=n(),X=n(),le=n(),_e=n();return N(L[2],d),b(L[1],U),h(x,L[1]),s(k,x,g),m(x,x,L[2]),w(k,L[2],k),h(X,k),h(le,X),s(_e,le,X),s(C,_e,x),s(C,C,k),o(C,C),s(C,C,x),s(C,C,k),s(C,C,k),s(L[0],C,k),h(a,L[0]),s(a,a,k),_(a,x)&&s(L[0],L[0],z),h(a,L[0]),s(a,a,k),_(a,x)?-1:(D(L[0])===U[31]>>7&&m(L[0],y,L[0]),s(L[3],L[0],L[1]),0)}function Q(L,U,C){const a=new Uint8Array(32),x=[n(),n(),n(),n()],k=[n(),n(),n(),n()];if(C.length!==r.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${r.SIGNATURE_LENGTH} bytes`);if(V(k,L))return!1;const X=new t.SHA512;X.update(C.subarray(0,32)),X.update(L),X.update(U);const le=X.digest();return q(le),p(x,k,le),u(k,C.subarray(32)),l(x,k),v(a,x),!K(C,a)}r.verify=Q;function Y(L){let U=[n(),n(),n(),n()];if(V(U,L))throw new Error("Ed25519: invalid public key");let C=n(),a=n(),x=U[1];w(C,d,x),m(a,d,x),H(a,a),s(C,C,a);let k=new Uint8Array(32);return M(k,C),k}r.convertPublicKeyToX25519=Y;function oe(L){const U=(0,t.hash)(L.subarray(0,32));U[0]&=248,U[31]&=127,U[31]|=64;const C=new Uint8Array(U.subarray(0,32));return(0,i.wipe)(U),C}r.convertSecretKeyToX25519=oe})(ki);const nu="EdDSA",su="JWT",Js=".",Xs="base64url",au="utf8",ou="utf8",cu=":",uu="did",hu="key",In="base58btc",lu="z",fu="K36",du=32;function Zs(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Si(r,e){e||(e=r.reduce((n,c)=>n+c.length,0));const t=Zs(e);let i=0;for(const n of r)t.set(n,i),i+=n.length;return t}function pu(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var c=r.charAt(n),y=c.charCodeAt(0);if(t[y]!==255)throw new TypeError(c+" is ambiguous");t[y]=n}var d=r.length,g=r.charAt(0),I=Math.log(d)/Math.log(256),S=Math.log(256)/Math.log(d);function A(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var B=0,M=0,K=0,_=T.length;K!==_&&T[K]===0;)K++,B++;for(var D=(_-K)*S+1>>>0,b=new Uint8Array(D);K!==_;){for(var w=T[K],m=0,s=D-1;(w!==0||m<M)&&s!==-1;s--,m++)w+=256*b[s]>>>0,b[s]=w%d>>>0,w=w/d>>>0;if(w!==0)throw new Error("Non-zero carry");M=m,K++}for(var h=D-M;h!==D&&b[h]===0;)h++;for(var H=g.repeat(B);h<D;++h)H+=r.charAt(b[h]);return H}function z(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var B=0;if(T[B]!==" "){for(var M=0,K=0;T[B]===g;)M++,B++;for(var _=(T.length-B)*I+1>>>0,D=new Uint8Array(_);T[B];){var b=t[T.charCodeAt(B)];if(b===255)return;for(var w=0,m=_-1;(b!==0||w<K)&&m!==-1;m--,w++)b+=d*D[m]>>>0,D[m]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");K=w,B++}if(T[B]!==" "){for(var s=_-K;s!==_&&D[s]===0;)s++;for(var h=new Uint8Array(M+(_-s)),H=M;s!==_;)h[H++]=D[s++];return h}}}function N(T){var B=z(T);if(B)return B;throw new Error(`Non-${e} character`)}return{encode:A,decodeUnsafe:z,decode:N}}var gu=pu,yu=gu;const Qs=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},_u=r=>new TextEncoder().encode(r),bu=r=>new TextDecoder().decode(r);class wu{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class mu{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ea(this,e)}}class vu{constructor(e){this.decoders=e}or(e){return ea(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ea=(r,e)=>new vu({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Eu{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new wu(e,t,i),this.decoder=new mu(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ii=({name:r,prefix:e,encode:t,decode:i})=>new Eu(r,e,t,i),Dr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:n}=yu(t,e);return ii({prefix:r,name:e,encode:i,decode:c=>Qs(n(c))})},Du=(r,e,t,i)=>{const n={};for(let S=0;S<e.length;++S)n[e[S]]=S;let c=r.length;for(;r[c-1]==="=";)--c;const y=new Uint8Array(c*t/8|0);let d=0,g=0,I=0;for(let S=0;S<c;++S){const A=n[r[S]];if(A===void 0)throw new SyntaxError(`Non-${i} character`);g=g<<t|A,d+=t,d>=8&&(d-=8,y[I++]=255&g>>d)}if(d>=t||255&g<<8-d)throw new SyntaxError("Unexpected end of data");return y},Su=(r,e,t)=>{const i=e[e.length-1]==="=",n=(1<<t)-1;let c="",y=0,d=0;for(let g=0;g<r.length;++g)for(d=d<<8|r[g],y+=8;y>t;)y-=t,c+=e[n&d>>y];if(y&&(c+=e[n&d<<t-y]),i)for(;c.length*t&7;)c+="=";return c},Qe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ii({prefix:e,name:r,encode(n){return Su(n,i,t)},decode(n){return Du(n,i,t,r)}}),Ou=ii({prefix:"\0",name:"identity",encode:r=>bu(r),decode:r=>_u(r)});var Iu=Object.freeze(Object.defineProperty({__proto__:null,identity:Ou},Symbol.toStringTag,{value:"Module"}));const xu=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Pu=Object.freeze(Object.defineProperty({__proto__:null,base2:xu},Symbol.toStringTag,{value:"Module"}));const Tu=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Au=Object.freeze(Object.defineProperty({__proto__:null,base8:Tu},Symbol.toStringTag,{value:"Module"}));const Nu=Dr({prefix:"9",name:"base10",alphabet:"0123456789"});var Cu=Object.freeze(Object.defineProperty({__proto__:null,base10:Nu},Symbol.toStringTag,{value:"Module"}));const Fu=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ru=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Uu=Object.freeze(Object.defineProperty({__proto__:null,base16:Fu,base16upper:Ru},Symbol.toStringTag,{value:"Module"}));const Lu=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Mu=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ju=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$u=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zu=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Hu=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bu=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ku=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qu=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Vu=Object.freeze(Object.defineProperty({__proto__:null,base32:Lu,base32upper:Mu,base32pad:ju,base32padupper:$u,base32hex:zu,base32hexupper:Hu,base32hexpad:Bu,base32hexpadupper:Ku,base32z:qu},Symbol.toStringTag,{value:"Module"}));const Gu=Dr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wu=Dr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ku=Object.freeze(Object.defineProperty({__proto__:null,base36:Gu,base36upper:Wu},Symbol.toStringTag,{value:"Module"}));const Yu=Dr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ju=Dr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Yu,base58flickr:Ju},Symbol.toStringTag,{value:"Module"}));const Zu=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qu=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),eh=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),th=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var rh=Object.freeze(Object.defineProperty({__proto__:null,base64:Zu,base64pad:Qu,base64url:eh,base64urlpad:th},Symbol.toStringTag,{value:"Module"}));const ta=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ih=ta.reduce((r,e,t)=>(r[t]=e,r),[]),nh=ta.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function sh(r){return r.reduce((e,t)=>(e+=ih[t],e),"")}function ah(r){const e=[];for(const t of r){const i=nh[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const oh=ii({prefix:"\u{1F680}",name:"base256emoji",encode:sh,decode:ah});var ch=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:oh},Symbol.toStringTag,{value:"Module"})),uh=ra,xn=128,hh=127,lh=~hh,fh=Math.pow(2,31);function ra(r,e,t){e=e||[],t=t||0;for(var i=t;r>=fh;)e[t++]=r&255|xn,r/=128;for(;r&lh;)e[t++]=r&255|xn,r>>>=7;return e[t]=r|0,ra.bytes=t-i+1,e}var dh=Oi,ph=128,Pn=127;function Oi(r,i){var t=0,i=i||0,n=0,c=i,y,d=r.length;do{if(c>=d)throw Oi.bytes=0,new RangeError("Could not decode varint");y=r[c++],t+=n<28?(y&Pn)<<n:(y&Pn)*Math.pow(2,n),n+=7}while(y>=ph);return Oi.bytes=c-i,t}var gh=Math.pow(2,7),yh=Math.pow(2,14),_h=Math.pow(2,21),bh=Math.pow(2,28),wh=Math.pow(2,35),mh=Math.pow(2,42),vh=Math.pow(2,49),Eh=Math.pow(2,56),Dh=Math.pow(2,63),Sh=function(r){return r<gh?1:r<yh?2:r<_h?3:r<bh?4:r<wh?5:r<mh?6:r<vh?7:r<Eh?8:r<Dh?9:10},Oh={encode:uh,decode:dh,encodingLength:Sh},ia=Oh;const Tn=(r,e,t=0)=>(ia.encode(r,e,t),e),An=r=>ia.encodingLength(r),Ii=(r,e)=>{const t=e.byteLength,i=An(r),n=i+An(t),c=new Uint8Array(n+t);return Tn(r,c,0),Tn(t,c,i),c.set(e,n),new Ih(r,t,e,c)};class Ih{constructor(e,t,i,n){this.code=e,this.size=t,this.digest=i,this.bytes=n}}const na=({name:r,code:e,encode:t})=>new xh(r,e,t);class xh{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ii(this.code,t):t.then(i=>Ii(this.code,i))}else throw Error("Unknown type, must be binary type")}}const sa=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ph=na({name:"sha2-256",code:18,encode:sa("SHA-256")}),Th=na({name:"sha2-512",code:19,encode:sa("SHA-512")});var Ah=Object.freeze(Object.defineProperty({__proto__:null,sha256:Ph,sha512:Th},Symbol.toStringTag,{value:"Module"}));const aa=0,Nh="identity",oa=Qs,Ch=r=>Ii(aa,oa(r)),Fh={code:aa,name:Nh,encode:oa,digest:Ch};var Rh=Object.freeze(Object.defineProperty({__proto__:null,identity:Fh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Nn={...Iu,...Pu,...Au,...Cu,...Uu,...Vu,...ku,...Xu,...rh,...ch};({...Ah,...Rh});function ca(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Cn=ca("utf8","u",r=>{const e=new TextDecoder("utf8");return"u"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),di=ca("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Zs(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),ua={utf8:Cn,"utf-8":Cn,hex:Nn.base16,latin1:di,ascii:di,binary:di,...Nn};function ut(r,e="utf8"){const t=ua[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function ot(r,e="utf8"){const t=ua[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function Kr(r){return ut(ot(ji(r),au),Xs)}function ha(r){const e=ot(fu,In),t=lu+ut(Si([e,r]),In);return[uu,hu,t].join(cu)}function Uh(r){return ut(r,Xs)}function Lh(r){return ot([Kr(r.header),Kr(r.payload)].join(Js),ou)}function Mh(r){return[Kr(r.header),Kr(r.payload),Uh(r.signature)].join(Js)}function Fn(r=nr.randomBytes(du)){return ki.generateKeyPairFromSeed(r)}async function jh(r,e,t,i,n=ee.fromMiliseconds(Date.now())){const c={alg:nu,typ:su},y=ha(i.publicKey),d=n+t,g={iss:y,sub:r,aud:e,iat:n,exp:d},I=Lh({header:c,payload:g}),S=ki.sign(i.secretKey,I);return Mh({header:c,payload:g,signature:S})}var Yi={},ni={};Object.defineProperty(ni,"__esModule",{value:!0});var rt=ie,xi=ft,$h=20;function zh(r,e,t){for(var i=1634760805,n=857760878,c=2036477234,y=1797285236,d=t[3]<<24|t[2]<<16|t[1]<<8|t[0],g=t[7]<<24|t[6]<<16|t[5]<<8|t[4],I=t[11]<<24|t[10]<<16|t[9]<<8|t[8],S=t[15]<<24|t[14]<<16|t[13]<<8|t[12],A=t[19]<<24|t[18]<<16|t[17]<<8|t[16],z=t[23]<<24|t[22]<<16|t[21]<<8|t[20],N=t[27]<<24|t[26]<<16|t[25]<<8|t[24],T=t[31]<<24|t[30]<<16|t[29]<<8|t[28],B=e[3]<<24|e[2]<<16|e[1]<<8|e[0],M=e[7]<<24|e[6]<<16|e[5]<<8|e[4],K=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],D=i,b=n,w=c,m=y,s=d,h=g,H=I,o=S,l=A,f=z,v=N,p=T,u=B,P=M,R=K,$=_,O=0;O<$h;O+=2)D=D+s|0,u^=D,u=u>>>32-16|u<<16,l=l+u|0,s^=l,s=s>>>32-12|s<<12,b=b+h|0,P^=b,P=P>>>32-16|P<<16,f=f+P|0,h^=f,h=h>>>32-12|h<<12,w=w+H|0,R^=w,R=R>>>32-16|R<<16,v=v+R|0,H^=v,H=H>>>32-12|H<<12,m=m+o|0,$^=m,$=$>>>32-16|$<<16,p=p+$|0,o^=p,o=o>>>32-12|o<<12,w=w+H|0,R^=w,R=R>>>32-8|R<<8,v=v+R|0,H^=v,H=H>>>32-7|H<<7,m=m+o|0,$^=m,$=$>>>32-8|$<<8,p=p+$|0,o^=p,o=o>>>32-7|o<<7,b=b+h|0,P^=b,P=P>>>32-8|P<<8,f=f+P|0,h^=f,h=h>>>32-7|h<<7,D=D+s|0,u^=D,u=u>>>32-8|u<<8,l=l+u|0,s^=l,s=s>>>32-7|s<<7,D=D+h|0,$^=D,$=$>>>32-16|$<<16,v=v+$|0,h^=v,h=h>>>32-12|h<<12,b=b+H|0,u^=b,u=u>>>32-16|u<<16,p=p+u|0,H^=p,H=H>>>32-12|H<<12,w=w+o|0,P^=w,P=P>>>32-16|P<<16,l=l+P|0,o^=l,o=o>>>32-12|o<<12,m=m+s|0,R^=m,R=R>>>32-16|R<<16,f=f+R|0,s^=f,s=s>>>32-12|s<<12,w=w+o|0,P^=w,P=P>>>32-8|P<<8,l=l+P|0,o^=l,o=o>>>32-7|o<<7,m=m+s|0,R^=m,R=R>>>32-8|R<<8,f=f+R|0,s^=f,s=s>>>32-7|s<<7,b=b+H|0,u^=b,u=u>>>32-8|u<<8,p=p+u|0,H^=p,H=H>>>32-7|H<<7,D=D+h|0,$^=D,$=$>>>32-8|$<<8,v=v+$|0,h^=v,h=h>>>32-7|h<<7;rt.writeUint32LE(D+i|0,r,0),rt.writeUint32LE(b+n|0,r,4),rt.writeUint32LE(w+c|0,r,8),rt.writeUint32LE(m+y|0,r,12),rt.writeUint32LE(s+d|0,r,16),rt.writeUint32LE(h+g|0,r,20),rt.writeUint32LE(H+I|0,r,24),rt.writeUint32LE(o+S|0,r,28),rt.writeUint32LE(l+A|0,r,32),rt.writeUint32LE(f+z|0,r,36),rt.writeUint32LE(v+N|0,r,40),rt.writeUint32LE(p+T|0,r,44),rt.writeUint32LE(u+B|0,r,48),rt.writeUint32LE(P+M|0,r,52),rt.writeUint32LE(R+K|0,r,56),rt.writeUint32LE($+_|0,r,60)}function la(r,e,t,i,n){if(n===void 0&&(n=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<t.length)throw new Error("ChaCha: destination is shorter than source");var c,y;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),y=c.length-e.length,c.set(e,y)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,y=n}for(var d=new Uint8Array(64),g=0;g<t.length;g+=64){zh(d,c,r);for(var I=g;I<g+64&&I<t.length;I++)i[I]=t[I]^d[I-g];Bh(c,0,y)}return xi.wipe(d),n===0&&xi.wipe(c),i}ni.streamXOR=la;function Hh(r,e,t,i){return i===void 0&&(i=0),xi.wipe(t),la(r,e,t,t,i)}ni.stream=Hh;function Bh(r,e,t){for(var i=1;t--;)i=i+(r[e]&255)|0,r[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var fa={},$t={};Object.defineProperty($t,"__esModule",{value:!0});function Kh(r,e,t){return~(r-1)&e|r-1&t}$t.select=Kh;function qh(r,e){return(r|0)-(e|0)-1>>>31&1}$t.lessOrEqual=qh;function da(r,e){if(r.length!==e.length)return 0;for(var t=0,i=0;i<r.length;i++)t|=r[i]^e[i];return 1&t-1>>>8}$t.compare=da;function Vh(r,e){return r.length===0||e.length===0?!1:da(r,e)!==0}$t.equal=Vh;(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=$t,t=ft;r.DIGEST_LENGTH=16;var i=function(){function y(d){this.digestLength=r.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var g=d[0]|d[1]<<8;this._r[0]=g&8191;var I=d[2]|d[3]<<8;this._r[1]=(g>>>13|I<<3)&8191;var S=d[4]|d[5]<<8;this._r[2]=(I>>>10|S<<6)&7939;var A=d[6]|d[7]<<8;this._r[3]=(S>>>7|A<<9)&8191;var z=d[8]|d[9]<<8;this._r[4]=(A>>>4|z<<12)&255,this._r[5]=z>>>1&8190;var N=d[10]|d[11]<<8;this._r[6]=(z>>>14|N<<2)&8191;var T=d[12]|d[13]<<8;this._r[7]=(N>>>11|T<<5)&8065;var B=d[14]|d[15]<<8;this._r[8]=(T>>>8|B<<8)&8191,this._r[9]=B>>>5&127,this._pad[0]=d[16]|d[17]<<8,this._pad[1]=d[18]|d[19]<<8,this._pad[2]=d[20]|d[21]<<8,this._pad[3]=d[22]|d[23]<<8,this._pad[4]=d[24]|d[25]<<8,this._pad[5]=d[26]|d[27]<<8,this._pad[6]=d[28]|d[29]<<8,this._pad[7]=d[30]|d[31]<<8}return y.prototype._blocks=function(d,g,I){for(var S=this._fin?0:2048,A=this._h[0],z=this._h[1],N=this._h[2],T=this._h[3],B=this._h[4],M=this._h[5],K=this._h[6],_=this._h[7],D=this._h[8],b=this._h[9],w=this._r[0],m=this._r[1],s=this._r[2],h=this._r[3],H=this._r[4],o=this._r[5],l=this._r[6],f=this._r[7],v=this._r[8],p=this._r[9];I>=16;){var u=d[g+0]|d[g+1]<<8;A+=u&8191;var P=d[g+2]|d[g+3]<<8;z+=(u>>>13|P<<3)&8191;var R=d[g+4]|d[g+5]<<8;N+=(P>>>10|R<<6)&8191;var $=d[g+6]|d[g+7]<<8;T+=(R>>>7|$<<9)&8191;var O=d[g+8]|d[g+9]<<8;B+=($>>>4|O<<12)&8191,M+=O>>>1&8191;var j=d[g+10]|d[g+11]<<8;K+=(O>>>14|j<<2)&8191;var q=d[g+12]|d[g+13]<<8;_+=(j>>>11|q<<5)&8191;var G=d[g+14]|d[g+15]<<8;D+=(q>>>8|G<<8)&8191,b+=G>>>5|S;var V=0,Q=V;Q+=A*w,Q+=z*(5*p),Q+=N*(5*v),Q+=T*(5*f),Q+=B*(5*l),V=Q>>>13,Q&=8191,Q+=M*(5*o),Q+=K*(5*H),Q+=_*(5*h),Q+=D*(5*s),Q+=b*(5*m),V+=Q>>>13,Q&=8191;var Y=V;Y+=A*m,Y+=z*w,Y+=N*(5*p),Y+=T*(5*v),Y+=B*(5*f),V=Y>>>13,Y&=8191,Y+=M*(5*l),Y+=K*(5*o),Y+=_*(5*H),Y+=D*(5*h),Y+=b*(5*s),V+=Y>>>13,Y&=8191;var oe=V;oe+=A*s,oe+=z*m,oe+=N*w,oe+=T*(5*p),oe+=B*(5*v),V=oe>>>13,oe&=8191,oe+=M*(5*f),oe+=K*(5*l),oe+=_*(5*o),oe+=D*(5*H),oe+=b*(5*h),V+=oe>>>13,oe&=8191;var L=V;L+=A*h,L+=z*s,L+=N*m,L+=T*w,L+=B*(5*p),V=L>>>13,L&=8191,L+=M*(5*v),L+=K*(5*f),L+=_*(5*l),L+=D*(5*o),L+=b*(5*H),V+=L>>>13,L&=8191;var U=V;U+=A*H,U+=z*h,U+=N*s,U+=T*m,U+=B*w,V=U>>>13,U&=8191,U+=M*(5*p),U+=K*(5*v),U+=_*(5*f),U+=D*(5*l),U+=b*(5*o),V+=U>>>13,U&=8191;var C=V;C+=A*o,C+=z*H,C+=N*h,C+=T*s,C+=B*m,V=C>>>13,C&=8191,C+=M*w,C+=K*(5*p),C+=_*(5*v),C+=D*(5*f),C+=b*(5*l),V+=C>>>13,C&=8191;var a=V;a+=A*l,a+=z*o,a+=N*H,a+=T*h,a+=B*s,V=a>>>13,a&=8191,a+=M*m,a+=K*w,a+=_*(5*p),a+=D*(5*v),a+=b*(5*f),V+=a>>>13,a&=8191;var x=V;x+=A*f,x+=z*l,x+=N*o,x+=T*H,x+=B*h,V=x>>>13,x&=8191,x+=M*s,x+=K*m,x+=_*w,x+=D*(5*p),x+=b*(5*v),V+=x>>>13,x&=8191;var k=V;k+=A*v,k+=z*f,k+=N*l,k+=T*o,k+=B*H,V=k>>>13,k&=8191,k+=M*h,k+=K*s,k+=_*m,k+=D*w,k+=b*(5*p),V+=k>>>13,k&=8191;var X=V;X+=A*p,X+=z*v,X+=N*f,X+=T*l,X+=B*o,V=X>>>13,X&=8191,X+=M*H,X+=K*h,X+=_*s,X+=D*m,X+=b*w,V+=X>>>13,X&=8191,V=(V<<2)+V|0,V=V+Q|0,Q=V&8191,V=V>>>13,Y+=V,A=Q,z=Y,N=oe,T=L,B=U,M=C,K=a,_=x,D=k,b=X,g+=16,I-=16}this._h[0]=A,this._h[1]=z,this._h[2]=N,this._h[3]=T,this._h[4]=B,this._h[5]=M,this._h[6]=K,this._h[7]=_,this._h[8]=D,this._h[9]=b},y.prototype.finish=function(d,g){g===void 0&&(g=0);var I=new Uint16Array(10),S,A,z,N;if(this._leftover){for(N=this._leftover,this._buffer[N++]=1;N<16;N++)this._buffer[N]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(S=this._h[1]>>>13,this._h[1]&=8191,N=2;N<10;N++)this._h[N]+=S,S=this._h[N]>>>13,this._h[N]&=8191;for(this._h[0]+=S*5,S=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=S,S=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=S,I[0]=this._h[0]+5,S=I[0]>>>13,I[0]&=8191,N=1;N<10;N++)I[N]=this._h[N]+S,S=I[N]>>>13,I[N]&=8191;for(I[9]-=1<<13,A=(S^1)-1,N=0;N<10;N++)I[N]&=A;for(A=~A,N=0;N<10;N++)this._h[N]=this._h[N]&A|I[N];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,z=this._h[0]+this._pad[0],this._h[0]=z&65535,N=1;N<8;N++)z=(this._h[N]+this._pad[N]|0)+(z>>>16)|0,this._h[N]=z&65535;return d[g+0]=this._h[0]>>>0,d[g+1]=this._h[0]>>>8,d[g+2]=this._h[1]>>>0,d[g+3]=this._h[1]>>>8,d[g+4]=this._h[2]>>>0,d[g+5]=this._h[2]>>>8,d[g+6]=this._h[3]>>>0,d[g+7]=this._h[3]>>>8,d[g+8]=this._h[4]>>>0,d[g+9]=this._h[4]>>>8,d[g+10]=this._h[5]>>>0,d[g+11]=this._h[5]>>>8,d[g+12]=this._h[6]>>>0,d[g+13]=this._h[6]>>>8,d[g+14]=this._h[7]>>>0,d[g+15]=this._h[7]>>>8,this._finished=!0,this},y.prototype.update=function(d){var g=0,I=d.length,S;if(this._leftover){S=16-this._leftover,S>I&&(S=I);for(var A=0;A<S;A++)this._buffer[this._leftover+A]=d[g+A];if(I-=S,g+=S,this._leftover+=S,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(I>=16&&(S=I-I%16,this._blocks(d,g,S),g+=S,I-=S),I){for(var A=0;A<I;A++)this._buffer[this._leftover+A]=d[g+A];this._leftover+=I}return this},y.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var d=new Uint8Array(16);return this.finish(d),d},y.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},y}();r.Poly1305=i;function n(y,d){var g=new i(y);g.update(d);var I=g.digest();return g.clean(),I}r.oneTimeAuth=n;function c(y,d){return y.length!==r.DIGEST_LENGTH||d.length!==r.DIGEST_LENGTH?!1:e.equal(y,d)}r.equal=c})(fa);(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=ni,t=fa,i=ft,n=ie,c=$t;r.KEY_LENGTH=32,r.NONCE_LENGTH=12,r.TAG_LENGTH=16;var y=new Uint8Array(16),d=function(){function g(I){if(this.nonceLength=r.NONCE_LENGTH,this.tagLength=r.TAG_LENGTH,I.length!==r.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(I)}return g.prototype.seal=function(I,S,A,z){if(I.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var N=new Uint8Array(16);N.set(I,N.length-I.length);var T=new Uint8Array(32);e.stream(this._key,N,T,4);var B=S.length+this.tagLength,M;if(z){if(z.length!==B)throw new Error("ChaCha20Poly1305: incorrect destination length");M=z}else M=new Uint8Array(B);return e.streamXOR(this._key,N,S,M,4),this._authenticate(M.subarray(M.length-this.tagLength,M.length),T,M.subarray(0,M.length-this.tagLength),A),i.wipe(N),M},g.prototype.open=function(I,S,A,z){if(I.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(S.length<this.tagLength)return null;var N=new Uint8Array(16);N.set(I,N.length-I.length);var T=new Uint8Array(32);e.stream(this._key,N,T,4);var B=new Uint8Array(this.tagLength);if(this._authenticate(B,T,S.subarray(0,S.length-this.tagLength),A),!c.equal(B,S.subarray(S.length-this.tagLength,S.length)))return null;var M=S.length-this.tagLength,K;if(z){if(z.length!==M)throw new Error("ChaCha20Poly1305: incorrect destination length");K=z}else K=new Uint8Array(M);return e.streamXOR(this._key,N,S.subarray(0,S.length-this.tagLength),K,4),i.wipe(N),K},g.prototype.clean=function(){return i.wipe(this._key),this},g.prototype._authenticate=function(I,S,A,z){var N=new t.Poly1305(S);z&&(N.update(z),z.length%16>0&&N.update(y.subarray(z.length%16))),N.update(A),A.length%16>0&&N.update(y.subarray(A.length%16));var T=new Uint8Array(8);z&&n.writeUint64LE(z.length,T),N.update(T),n.writeUint64LE(A.length,T),N.update(T);for(var B=N.digest(),M=0;M<B.length;M++)I[M]=B[M];N.clean(),i.wipe(B),i.wipe(T)},g}();r.ChaCha20Poly1305=d})(Yi);var pa={},Sr={},Ji={};Object.defineProperty(Ji,"__esModule",{value:!0});function Gh(r){return typeof r.saveState!="undefined"&&typeof r.restoreState!="undefined"&&typeof r.cleanSavedState!="undefined"}Ji.isSerializableHash=Gh;Object.defineProperty(Sr,"__esModule",{value:!0});var mt=Ji,Wh=$t,kh=ft,ga=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(i).clean():i.set(t);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),mt.isSerializableHash(this._inner)&&mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),kh.wipe(i)}return r.prototype.reset=function(){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();Sr.HMAC=ga;function Yh(r,e,t){var i=new ga(r,e);i.update(t);var n=i.digest();return i.clean(),n}Sr.hmac=Yh;Sr.equal=Wh.equal;Object.defineProperty(pa,"__esModule",{value:!0});var Rn=Sr,Un=ft,Jh=function(){function r(e,t,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var c=Rn.hmac(this._hash,i,t);this._hmac=new Rn.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),i=0;i<t.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[i]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),Un.wipe(this._buffer),Un.wipe(this._counter),this._bufpos=0},r}(),Xh=pa.HKDF=Jh,si={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=ie,t=ft;r.DIGEST_LENGTH=32,r.BLOCK_SIZE=64;var i=function(){function d(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return d.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},d.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},d.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},d.prototype.update=function(g,I){if(I===void 0&&(I=g.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var S=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&I>0;)this._buffer[this._bufferLength++]=g[S++],I--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(S=c(this._temp,this._state,g,S,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=g[S++],I--;return this},d.prototype.finish=function(g){if(!this._finished){var I=this._bytesHashed,S=this._bufferLength,A=I/536870912|0,z=I<<3,N=I%64<56?64:128;this._buffer[S]=128;for(var T=S+1;T<N-8;T++)this._buffer[T]=0;e.writeUint32BE(A,this._buffer,N-8),e.writeUint32BE(z,this._buffer,N-4),c(this._temp,this._state,this._buffer,0,N),this._finished=!0}for(var T=0;T<this.digestLength/4;T++)e.writeUint32BE(this._state[T],g,T*4);return this},d.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},d.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},d.prototype.restoreState=function(g){return this._state.set(g.state),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},d.prototype.cleanSavedState=function(g){t.wipe(g.state),g.buffer&&t.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},d}();r.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(d,g,I,S,A){for(;A>=64;){for(var z=g[0],N=g[1],T=g[2],B=g[3],M=g[4],K=g[5],_=g[6],D=g[7],b=0;b<16;b++){var w=S+b*4;d[b]=e.readUint32BE(I,w)}for(var b=16;b<64;b++){var m=d[b-2],s=(m>>>17|m<<32-17)^(m>>>19|m<<32-19)^m>>>10;m=d[b-15];var h=(m>>>7|m<<32-7)^(m>>>18|m<<32-18)^m>>>3;d[b]=(s+d[b-7]|0)+(h+d[b-16]|0)}for(var b=0;b<64;b++){var s=(((M>>>6|M<<26)^(M>>>11|M<<21)^(M>>>25|M<<7))+(M&K^~M&_)|0)+(D+(n[b]+d[b]|0)|0)|0,h=((z>>>2|z<<32-2)^(z>>>13|z<<32-13)^(z>>>22|z<<32-22))+(z&N^z&T^N&T)|0;D=_,_=K,K=M,M=B+s|0,B=T,T=N,N=z,z=s+h|0}g[0]+=z,g[1]+=N,g[2]+=T,g[3]+=B,g[4]+=M,g[5]+=K,g[6]+=_,g[7]+=D,S+=64,A-=64}return S}function y(d){var g=new i;g.update(d);var I=g.digest();return g.clean(),I}r.hash=y})(si);var Xi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.sharedKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.scalarMultBase=r.scalarMult=r.SHARED_KEY_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=void 0;const e=nr,t=ft;r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=32,r.SHARED_KEY_LENGTH=32;function i(b){const w=new Float64Array(16);if(b)for(let m=0;m<b.length;m++)w[m]=b[m];return w}const n=new Uint8Array(32);n[0]=9;const c=i([56129,1]);function y(b){let w=1;for(let m=0;m<16;m++){let s=b[m]+w+65535;w=Math.floor(s/65536),b[m]=s-w*65536}b[0]+=w-1+37*(w-1)}function d(b,w,m){const s=~(m-1);for(let h=0;h<16;h++){const H=s&(b[h]^w[h]);b[h]^=H,w[h]^=H}}function g(b,w){const m=i(),s=i();for(let h=0;h<16;h++)s[h]=w[h];y(s),y(s),y(s);for(let h=0;h<2;h++){m[0]=s[0]-65517;for(let o=1;o<15;o++)m[o]=s[o]-65535-(m[o-1]>>16&1),m[o-1]&=65535;m[15]=s[15]-32767-(m[14]>>16&1);const H=m[15]>>16&1;m[14]&=65535,d(s,m,1-H)}for(let h=0;h<16;h++)b[2*h]=s[h]&255,b[2*h+1]=s[h]>>8}function I(b,w){for(let m=0;m<16;m++)b[m]=w[2*m]+(w[2*m+1]<<8);b[15]&=32767}function S(b,w,m){for(let s=0;s<16;s++)b[s]=w[s]+m[s]}function A(b,w,m){for(let s=0;s<16;s++)b[s]=w[s]-m[s]}function z(b,w,m){let s,h,H=0,o=0,l=0,f=0,v=0,p=0,u=0,P=0,R=0,$=0,O=0,j=0,q=0,G=0,V=0,Q=0,Y=0,oe=0,L=0,U=0,C=0,a=0,x=0,k=0,X=0,le=0,_e=0,de=0,me=0,Re=0,Ae=0,ye=m[0],pe=m[1],fe=m[2],ue=m[3],ce=m[4],ae=m[5],se=m[6],te=m[7],he=m[8],ge=m[9],re=m[10],be=m[11],we=m[12],Ee=m[13],De=m[14],ve=m[15];s=w[0],H+=s*ye,o+=s*pe,l+=s*fe,f+=s*ue,v+=s*ce,p+=s*ae,u+=s*se,P+=s*te,R+=s*he,$+=s*ge,O+=s*re,j+=s*be,q+=s*we,G+=s*Ee,V+=s*De,Q+=s*ve,s=w[1],o+=s*ye,l+=s*pe,f+=s*fe,v+=s*ue,p+=s*ce,u+=s*ae,P+=s*se,R+=s*te,$+=s*he,O+=s*ge,j+=s*re,q+=s*be,G+=s*we,V+=s*Ee,Q+=s*De,Y+=s*ve,s=w[2],l+=s*ye,f+=s*pe,v+=s*fe,p+=s*ue,u+=s*ce,P+=s*ae,R+=s*se,$+=s*te,O+=s*he,j+=s*ge,q+=s*re,G+=s*be,V+=s*we,Q+=s*Ee,Y+=s*De,oe+=s*ve,s=w[3],f+=s*ye,v+=s*pe,p+=s*fe,u+=s*ue,P+=s*ce,R+=s*ae,$+=s*se,O+=s*te,j+=s*he,q+=s*ge,G+=s*re,V+=s*be,Q+=s*we,Y+=s*Ee,oe+=s*De,L+=s*ve,s=w[4],v+=s*ye,p+=s*pe,u+=s*fe,P+=s*ue,R+=s*ce,$+=s*ae,O+=s*se,j+=s*te,q+=s*he,G+=s*ge,V+=s*re,Q+=s*be,Y+=s*we,oe+=s*Ee,L+=s*De,U+=s*ve,s=w[5],p+=s*ye,u+=s*pe,P+=s*fe,R+=s*ue,$+=s*ce,O+=s*ae,j+=s*se,q+=s*te,G+=s*he,V+=s*ge,Q+=s*re,Y+=s*be,oe+=s*we,L+=s*Ee,U+=s*De,C+=s*ve,s=w[6],u+=s*ye,P+=s*pe,R+=s*fe,$+=s*ue,O+=s*ce,j+=s*ae,q+=s*se,G+=s*te,V+=s*he,Q+=s*ge,Y+=s*re,oe+=s*be,L+=s*we,U+=s*Ee,C+=s*De,a+=s*ve,s=w[7],P+=s*ye,R+=s*pe,$+=s*fe,O+=s*ue,j+=s*ce,q+=s*ae,G+=s*se,V+=s*te,Q+=s*he,Y+=s*ge,oe+=s*re,L+=s*be,U+=s*we,C+=s*Ee,a+=s*De,x+=s*ve,s=w[8],R+=s*ye,$+=s*pe,O+=s*fe,j+=s*ue,q+=s*ce,G+=s*ae,V+=s*se,Q+=s*te,Y+=s*he,oe+=s*ge,L+=s*re,U+=s*be,C+=s*we,a+=s*Ee,x+=s*De,k+=s*ve,s=w[9],$+=s*ye,O+=s*pe,j+=s*fe,q+=s*ue,G+=s*ce,V+=s*ae,Q+=s*se,Y+=s*te,oe+=s*he,L+=s*ge,U+=s*re,C+=s*be,a+=s*we,x+=s*Ee,k+=s*De,X+=s*ve,s=w[10],O+=s*ye,j+=s*pe,q+=s*fe,G+=s*ue,V+=s*ce,Q+=s*ae,Y+=s*se,oe+=s*te,L+=s*he,U+=s*ge,C+=s*re,a+=s*be,x+=s*we,k+=s*Ee,X+=s*De,le+=s*ve,s=w[11],j+=s*ye,q+=s*pe,G+=s*fe,V+=s*ue,Q+=s*ce,Y+=s*ae,oe+=s*se,L+=s*te,U+=s*he,C+=s*ge,a+=s*re,x+=s*be,k+=s*we,X+=s*Ee,le+=s*De,_e+=s*ve,s=w[12],q+=s*ye,G+=s*pe,V+=s*fe,Q+=s*ue,Y+=s*ce,oe+=s*ae,L+=s*se,U+=s*te,C+=s*he,a+=s*ge,x+=s*re,k+=s*be,X+=s*we,le+=s*Ee,_e+=s*De,de+=s*ve,s=w[13],G+=s*ye,V+=s*pe,Q+=s*fe,Y+=s*ue,oe+=s*ce,L+=s*ae,U+=s*se,C+=s*te,a+=s*he,x+=s*ge,k+=s*re,X+=s*be,le+=s*we,_e+=s*Ee,de+=s*De,me+=s*ve,s=w[14],V+=s*ye,Q+=s*pe,Y+=s*fe,oe+=s*ue,L+=s*ce,U+=s*ae,C+=s*se,a+=s*te,x+=s*he,k+=s*ge,X+=s*re,le+=s*be,_e+=s*we,de+=s*Ee,me+=s*De,Re+=s*ve,s=w[15],Q+=s*ye,Y+=s*pe,oe+=s*fe,L+=s*ue,U+=s*ce,C+=s*ae,a+=s*se,x+=s*te,k+=s*he,X+=s*ge,le+=s*re,_e+=s*be,de+=s*we,me+=s*Ee,Re+=s*De,Ae+=s*ve,H+=38*Y,o+=38*oe,l+=38*L,f+=38*U,v+=38*C,p+=38*a,u+=38*x,P+=38*k,R+=38*X,$+=38*le,O+=38*_e,j+=38*de,q+=38*me,G+=38*Re,V+=38*Ae,h=1,s=H+h+65535,h=Math.floor(s/65536),H=s-h*65536,s=o+h+65535,h=Math.floor(s/65536),o=s-h*65536,s=l+h+65535,h=Math.floor(s/65536),l=s-h*65536,s=f+h+65535,h=Math.floor(s/65536),f=s-h*65536,s=v+h+65535,h=Math.floor(s/65536),v=s-h*65536,s=p+h+65535,h=Math.floor(s/65536),p=s-h*65536,s=u+h+65535,h=Math.floor(s/65536),u=s-h*65536,s=P+h+65535,h=Math.floor(s/65536),P=s-h*65536,s=R+h+65535,h=Math.floor(s/65536),R=s-h*65536,s=$+h+65535,h=Math.floor(s/65536),$=s-h*65536,s=O+h+65535,h=Math.floor(s/65536),O=s-h*65536,s=j+h+65535,h=Math.floor(s/65536),j=s-h*65536,s=q+h+65535,h=Math.floor(s/65536),q=s-h*65536,s=G+h+65535,h=Math.floor(s/65536),G=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=Q+h+65535,h=Math.floor(s/65536),Q=s-h*65536,H+=h-1+37*(h-1),h=1,s=H+h+65535,h=Math.floor(s/65536),H=s-h*65536,s=o+h+65535,h=Math.floor(s/65536),o=s-h*65536,s=l+h+65535,h=Math.floor(s/65536),l=s-h*65536,s=f+h+65535,h=Math.floor(s/65536),f=s-h*65536,s=v+h+65535,h=Math.floor(s/65536),v=s-h*65536,s=p+h+65535,h=Math.floor(s/65536),p=s-h*65536,s=u+h+65535,h=Math.floor(s/65536),u=s-h*65536,s=P+h+65535,h=Math.floor(s/65536),P=s-h*65536,s=R+h+65535,h=Math.floor(s/65536),R=s-h*65536,s=$+h+65535,h=Math.floor(s/65536),$=s-h*65536,s=O+h+65535,h=Math.floor(s/65536),O=s-h*65536,s=j+h+65535,h=Math.floor(s/65536),j=s-h*65536,s=q+h+65535,h=Math.floor(s/65536),q=s-h*65536,s=G+h+65535,h=Math.floor(s/65536),G=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=Q+h+65535,h=Math.floor(s/65536),Q=s-h*65536,H+=h-1+37*(h-1),b[0]=H,b[1]=o,b[2]=l,b[3]=f,b[4]=v,b[5]=p,b[6]=u,b[7]=P,b[8]=R,b[9]=$,b[10]=O,b[11]=j,b[12]=q,b[13]=G,b[14]=V,b[15]=Q}function N(b,w){z(b,w,w)}function T(b,w){const m=i();for(let s=0;s<16;s++)m[s]=w[s];for(let s=253;s>=0;s--)N(m,m),s!==2&&s!==4&&z(m,m,w);for(let s=0;s<16;s++)b[s]=m[s]}function B(b,w){const m=new Uint8Array(32),s=new Float64Array(80),h=i(),H=i(),o=i(),l=i(),f=i(),v=i();for(let R=0;R<31;R++)m[R]=b[R];m[31]=b[31]&127|64,m[0]&=248,I(s,w);for(let R=0;R<16;R++)H[R]=s[R];h[0]=l[0]=1;for(let R=254;R>=0;--R){const $=m[R>>>3]>>>(R&7)&1;d(h,H,$),d(o,l,$),S(f,h,o),A(h,h,o),S(o,H,l),A(H,H,l),N(l,f),N(v,h),z(h,o,h),z(o,H,f),S(f,h,o),A(h,h,o),N(H,h),A(o,l,v),z(h,o,c),S(h,h,l),z(o,o,h),z(h,l,v),z(l,H,s),N(H,f),d(h,H,$),d(o,l,$)}for(let R=0;R<16;R++)s[R+16]=h[R],s[R+32]=o[R],s[R+48]=H[R],s[R+64]=l[R];const p=s.subarray(32),u=s.subarray(16);T(p,p),z(u,u,p);const P=new Uint8Array(32);return g(P,u),P}r.scalarMult=B;function M(b){return B(b,n)}r.scalarMultBase=M;function K(b){if(b.length!==r.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${r.SECRET_KEY_LENGTH} bytes`);const w=new Uint8Array(b);return{publicKey:M(w),secretKey:w}}r.generateKeyPairFromSeed=K;function _(b){const w=(0,e.randomBytes)(32,b),m=K(w);return(0,t.wipe)(w),m}r.generateKeyPair=_;function D(b,w,m=!1){if(b.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(w.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const s=B(b,w);if(m){let h=0;for(let H=0;H<s.length;H++)h|=s[H];if(h===0)throw new Error("X25519: invalid shared key")}return s}r.sharedKey=D})(Xi);var Ln=globalThis&&globalThis.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,c;i<n;i++)(c||!(i in e))&&(c||(c=Array.prototype.slice.call(e,0,i)),c[i]=e[i]);return r.concat(c||Array.prototype.slice.call(e))},Zh=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),Qh=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),el=function(){function r(e,t,i,n){this.name=e,this.version=t,this.os=i,this.bot=n,this.type="bot-device"}return r}(),tl=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),rl=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),il=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,nl=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Mn=3,sl=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",il]],jn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function al(r){return r?$n(r):typeof document=="undefined"&&typeof navigator!="undefined"&&navigator.product==="ReactNative"?new rl:typeof navigator!="undefined"?$n(navigator.userAgent):ul()}function ol(r){return r!==""&&sl.reduce(function(e,t){var i=t[0],n=t[1];if(e)return e;var c=n.exec(r);return!!c&&[i,c]},!1)}function $n(r){var e=ol(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new tl;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Mn&&(n=Ln(Ln([],n,!0),hl(Mn-n.length),!0)):n=[];var c=n.join("."),y=cl(r),d=nl.exec(r);return d&&d[1]?new el(t,c,y,d[1]):new Zh(t,c,y)}function cl(r){for(var e=0,t=jn.length;e<t;e++){var i=jn[e],n=i[0],c=i[1],y=c.exec(r);if(y)return n}return null}function ul(){var r=typeof process!="undefined"&&process.version;return r?new Qh(process.version.slice(1)):null}function hl(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=_a=Oe.getLocation=Oe.getLocationOrThrow=Zi=Oe.getNavigator=Oe.getNavigatorOrThrow=ya=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function Wt(r){let e;return typeof window!="undefined"&&typeof window[r]!="undefined"&&(e=window[r]),e}Oe.getFromWindow=Wt;function sr(r){const e=Wt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Oe.getFromWindowOrThrow=sr;function ll(){return sr("document")}Oe.getDocumentOrThrow=ll;function fl(){return Wt("document")}var ya=Oe.getDocument=fl;function dl(){return sr("navigator")}Oe.getNavigatorOrThrow=dl;function pl(){return Wt("navigator")}var Zi=Oe.getNavigator=pl;function gl(){return sr("location")}Oe.getLocationOrThrow=gl;function yl(){return Wt("location")}var _a=Oe.getLocation=yl;function _l(){return sr("crypto")}Oe.getCryptoOrThrow=_l;function bl(){return Wt("crypto")}Oe.getCrypto=bl;function wl(){return sr("localStorage")}Oe.getLocalStorageOrThrow=wl;function ml(){return Wt("localStorage")}Oe.getLocalStorage=ml;var Qi={};Object.defineProperty(Qi,"__esModule",{value:!0});var ba=Qi.getWindowMetadata=void 0;const zn=Oe;function vl(){let r,e;try{r=zn.getDocumentOrThrow(),e=zn.getLocationOrThrow()}catch{return null}function t(){const A=r.getElementsByTagName("link"),z=[];for(let N=0;N<A.length;N++){const T=A[N],B=T.getAttribute("rel");if(B&&B.toLowerCase().indexOf("icon")>-1){const M=T.getAttribute("href");if(M)if(M.toLowerCase().indexOf("https:")===-1&&M.toLowerCase().indexOf("http:")===-1&&M.indexOf("//")!==0){let K=e.protocol+"//"+e.host;if(M.indexOf("/")===0)K+=M;else{const _=e.pathname.split("/");_.pop(),K+=_.join("/")+"/"+M}z.push(K)}else if(M.indexOf("//")===0){const K=e.protocol+M;z.push(K)}else z.push(M)}}return z}function i(...A){const z=r.getElementsByTagName("meta");for(let N=0;N<z.length;N++){const T=z[N],B=["itemprop","property","name"].map(M=>T.getAttribute(M)).filter(M=>M?A.includes(M):!1);if(B.length&&B){const M=T.getAttribute("content");if(M)return M}}return""}function n(){let A=i("name","og:site_name","og:title","twitter:title");return A||(A=r.title),A}function c(){return i("description","og:description","twitter:description","keywords")}const y=n(),d=c(),g=e.origin,I=t();return{description:d,url:g,icons:I,name:y}}ba=Qi.getWindowMetadata=vl;var gr={},wa=function(r,e){for(var t={},i=Object.keys(r),n=Array.isArray(e),c=0;c<i.length;c++){var y=i[c],d=r[y];(n?e.indexOf(y)!==-1:e(y,d,r))&&(t[y]=d)}return t};(function(r){const e=Os,t=Is,i=Ss,n=wa,c=_=>_==null,y=Symbol("encodeFragmentIdentifier");function d(_){switch(_.arrayFormat){case"index":return D=>(b,w)=>{const m=b.length;return w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(D,_),"[",m,"]"].join("")]:[...b,[S(D,_),"[",S(m,_),"]=",S(w,_)].join("")]};case"bracket":return D=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(D,_),"[]"].join("")]:[...b,[S(D,_),"[]=",S(w,_)].join("")];case"colon-list-separator":return D=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(D,_),":list="].join("")]:[...b,[S(D,_),":list=",S(w,_)].join("")];case"comma":case"separator":case"bracket-separator":{const D=_.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(w,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?w:(m=m===null?"":m,w.length===0?[[S(b,_),D,S(m,_)].join("")]:[[w,S(m,_)].join(_.arrayFormatSeparator)])}default:return D=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,S(D,_)]:[...b,[S(D,_),"=",S(w,_)].join("")]}}function g(_){let D;switch(_.arrayFormat){case"index":return(b,w,m)=>{if(D=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!D){m[b]=w;return}m[b]===void 0&&(m[b]={}),m[b][D[1]]=w};case"bracket":return(b,w,m)=>{if(D=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!D){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"colon-list-separator":return(b,w,m)=>{if(D=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!D){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"comma":case"separator":return(b,w,m)=>{const s=typeof w=="string"&&w.includes(_.arrayFormatSeparator),h=typeof w=="string"&&!s&&A(w,_).includes(_.arrayFormatSeparator);w=h?A(w,_):w;const H=s||h?w.split(_.arrayFormatSeparator).map(o=>A(o,_)):w===null?w:A(w,_);m[b]=H};case"bracket-separator":return(b,w,m)=>{const s=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!s){m[b]=w&&A(w,_);return}const h=w===null?[]:w.split(_.arrayFormatSeparator).map(H=>A(H,_));if(m[b]===void 0){m[b]=h;return}m[b]=[].concat(m[b],h)};default:return(b,w,m)=>{if(m[b]===void 0){m[b]=w;return}m[b]=[].concat(m[b],w)}}}function I(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(_,D){return D.encode?D.strict?e(_):encodeURIComponent(_):_}function A(_,D){return D.decode?t(_):_}function z(_){return Array.isArray(_)?_.sort():typeof _=="object"?z(Object.keys(_)).sort((D,b)=>Number(D)-Number(b)).map(D=>_[D]):_}function N(_){const D=_.indexOf("#");return D!==-1&&(_=_.slice(0,D)),_}function T(_){let D="";const b=_.indexOf("#");return b!==-1&&(D=_.slice(b)),D}function B(_){_=N(_);const D=_.indexOf("?");return D===-1?"":_.slice(D+1)}function M(_,D){return D.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):D.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function K(_,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),I(D.arrayFormatSeparator);const b=g(D),w=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return w;for(const m of _.split("&")){if(m==="")continue;let[s,h]=i(D.decode?m.replace(/\+/g," "):m,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?h:A(h,D),b(A(s,D),h,w)}for(const m of Object.keys(w)){const s=w[m];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=M(s[h],D);else w[m]=M(s,D)}return D.sort===!1?w:(D.sort===!0?Object.keys(w).sort():Object.keys(w).sort(D.sort)).reduce((m,s)=>{const h=w[s];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?m[s]=z(h):m[s]=h,m},Object.create(null))}r.extract=B,r.parse=K,r.stringify=(_,D)=>{if(!_)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),I(D.arrayFormatSeparator);const b=h=>D.skipNull&&c(_[h])||D.skipEmptyString&&_[h]==="",w=d(D),m={};for(const h of Object.keys(_))b(h)||(m[h]=_[h]);const s=Object.keys(m);return D.sort!==!1&&s.sort(D.sort),s.map(h=>{const H=_[h];return H===void 0?"":H===null?S(h,D):Array.isArray(H)?H.length===0&&D.arrayFormat==="bracket-separator"?S(h,D)+"[]":H.reduce(w(h),[]).join("&"):S(h,D)+"="+S(H,D)}).filter(h=>h.length>0).join("&")},r.parseUrl=(_,D)=>{D=Object.assign({decode:!0},D);const[b,w]=i(_,"#");return Object.assign({url:b.split("?")[0]||"",query:K(B(_),D)},D&&D.parseFragmentIdentifier&&w?{fragmentIdentifier:A(w,D)}:{})},r.stringifyUrl=(_,D)=>{D=Object.assign({encode:!0,strict:!0,[y]:!0},D);const b=N(_.url).split("?")[0]||"",w=r.extract(_.url),m=r.parse(w,{sort:!1}),s=Object.assign(m,_.query);let h=r.stringify(s,D);h&&(h=`?${h}`);let H=T(_.url);return _.fragmentIdentifier&&(H=`#${D[y]?S(_.fragmentIdentifier,D):_.fragmentIdentifier}`),`${b}${h}${H}`},r.pick=(_,D,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[y]:!1},b);const{url:w,query:m,fragmentIdentifier:s}=r.parseUrl(_,b);return r.stringifyUrl({url:w,query:n(m,D),fragmentIdentifier:s},b)},r.exclude=(_,D,b)=>{const w=Array.isArray(D)?m=>!D.includes(m):(m,s)=>!D(m,s);return r.pick(_,w,b)}})(gr);const El={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}},ma="base10",ct="base16",Pi="base64pad",en="utf8",va=0,kt=1,Dl=0,Hn=1,Ti=12,tn=32;function Sl(){const r=Xi.generateKeyPair();return{privateKey:ut(r.secretKey,ct),publicKey:ut(r.publicKey,ct)}}function Ai(){const r=nr.randomBytes(tn);return ut(r,ct)}function Ol(r,e){const t=Xi.sharedKey(ot(r,ct),ot(e,ct)),i=new Xh(si.SHA256,t).expand(tn);return ut(i,ct)}function Il(r){const e=si.hash(ot(r,ct));return ut(e,ct)}function Ni(r){const e=si.hash(ot(r,en));return ut(e,ct)}function xl(r){return ot(`${r}`,ma)}function Or(r){return Number(ut(r,ma))}function Pl(r){const e=xl(typeof r.type<"u"?r.type:va);if(Or(e)===kt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?ot(r.senderPublicKey,ct):void 0,i=typeof r.iv<"u"?ot(r.iv,ct):nr.randomBytes(Ti),n=new Yi.ChaCha20Poly1305(ot(r.symKey,ct)).seal(i,ot(r.message,en));return Al({type:e,sealed:n,iv:i,senderPublicKey:t})}function Tl(r){const e=new Yi.ChaCha20Poly1305(ot(r.symKey,ct)),{sealed:t,iv:i}=rn(r.encoded),n=e.open(i,t);if(n===null)throw new Error("Failed to decrypt");return ut(n,en)}function Al(r){if(Or(r.type)===kt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ut(Si([r.type,r.senderPublicKey,r.iv,r.sealed]),Pi)}return ut(Si([r.type,r.iv,r.sealed]),Pi)}function rn(r){const e=ot(r,Pi),t=e.slice(Dl,Hn),i=Hn;if(Or(t)===kt){const d=i+tn,g=d+Ti,I=e.slice(i,d),S=e.slice(d,g),A=e.slice(g);return{type:t,sealed:A,iv:S,senderPublicKey:I}}const n=i+Ti,c=e.slice(i,n),y=e.slice(n);return{type:t,sealed:y,iv:c}}function Nl(r,e){const t=rn(r);return Ea({type:Or(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ut(t.senderPublicKey,ct):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ea(r){const e=(r==null?void 0:r.type)||va;if(e===kt){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Bn(r){return r.type===kt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}var Cl=Object.defineProperty,Kn=Object.getOwnPropertySymbols,Fl=Object.prototype.hasOwnProperty,Rl=Object.prototype.propertyIsEnumerable,qn=(r,e,t)=>e in r?Cl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vn=(r,e)=>{for(var t in e||(e={}))Fl.call(e,t)&&qn(r,t,e[t]);if(Kn)for(var t of Kn(e))Rl.call(e,t)&&qn(r,t,e[t]);return r};const Ul="ReactNative",fr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Ll="js";function Da(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ml(){return!ya()&&!!Zi()&&navigator.product===Ul}function jl(){return!Da()&&!!Zi()}function $l(){return Ml()?fr.reactNative:Da()?fr.node:jl()?fr.browser:fr.unknown}function zl(r,e){let t=gr.parse(r);return t=Vn(Vn({},t),e),r=gr.stringify(t),r}function Hl(){return ba()||{name:"",description:"",url:"",icons:[""]}}function Bl(){const r=al();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function Kl(){var r;const e=$l();return e===fr.browser?[e,((r=_a())==null?void 0:r.host)||"unknown"].join(":"):e}function ql(r,e,t){const i=Bl(),n=Kl();return[[r,e].join("-"),[Ll,t].join("-"),i,n].join("/")}function Vl({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:n,projectId:c}){const y=t.split("?"),d=ql(r,e,i),g={auth:n,ua:d,projectId:c},I=zl(y[1]||"",g);return y[0]+"?"+I}function Lt(r,e){return r.filter(t=>e.includes(t)).length===r.length}function Sa(r){return Object.fromEntries(r.entries())}function Oa(r){return new Map(Object.entries(r))}function Dt(r,e){return ee.fromMiliseconds((e||Date.now())+ee.toMiliseconds(r))}function Ut(r){return ee.fromMiliseconds(Date.now())>=ee.toMiliseconds(r)}function qt(r){const e=ee.toMiliseconds(r||ee.FIVE_MINUTES);let t,i,n;return{resolve:c=>{n&&t&&(clearTimeout(n),t(c))},reject:c=>{n&&i&&(clearTimeout(n),i(c))},done:()=>new Promise((c,y)=>{n=setTimeout(y,e),t=c,i=y})}}function Ia(r,e){return new Promise(async(t,i)=>{const n=setTimeout(()=>i(),e),c=await r;clearTimeout(n),t(c)})}function xa(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function Gl(r){return xa("topic",r)}function Wl(r){return xa("id",r)}function Pa(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function Ue(r,e){return`${r}${e?`:${e}`:""}`}const kl="irn";function Ci(r){return(r==null?void 0:r.relay)||{protocol:kl}}function Fi(r){const e=El[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var Yl=Object.defineProperty,Gn=Object.getOwnPropertySymbols,Jl=Object.prototype.hasOwnProperty,Xl=Object.prototype.propertyIsEnumerable,Wn=(r,e,t)=>e in r?Yl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zl=(r,e)=>{for(var t in e||(e={}))Jl.call(e,t)&&Wn(r,t,e[t]);if(Gn)for(var t of Gn(e))Xl.call(e,t)&&Wn(r,t,e[t]);return r};function Ql(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(n=>{if(n.startsWith(i)){const c=n.replace(i,""),y=r[n];t[c]=y}}),t}function ef(r){const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),n=r.substring(e+1,t).split("@"),c=typeof t<"u"?r.substring(t):"",y=gr.parse(c);return{protocol:i,topic:n[0],version:parseInt(n[1],10),symKey:y.symKey,relay:Ql(y)}}function tf(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(n=>{const c=t+e+n;r[n]&&(i[c]=r[n])}),i}function rf(r){return`${r.protocol}:${r.topic}@${r.version}?`+gr.stringify(Zl({symKey:r.symKey},tf(r.relay)))}function Ir(r){const e=[];return r.forEach(t=>{const[i,n]=t.split(":");e.push(`${i}:${n}`)}),e}function nf(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Ir(t.accounts))}),e}function sf(r,e){const t=[];return Object.values(r).forEach(i=>{Ir(i.accounts).includes(e)&&t.push(...i.methods)}),t}function af(r,e){const t=[];return Object.values(r).forEach(i=>{Ir(i.accounts).includes(e)&&t.push(...i.events)}),t}function of(r,e){const t=zr(r,e);if(t)throw new Error(t.message);const i={};for(const[n,c]of Object.entries(r))i[n]={methods:c.methods,events:c.events,chains:c.accounts.map(y=>`${y.split(":")[0]}:${y.split(":")[1]}`)};return i}const cf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},uf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function J(r,e){const{message:t,code:i}=uf[r];return{message:e?`${t} ${e}`:t,code:i}}function Je(r,e){const{message:t,code:i}=cf[r];return{message:e?`${t} ${e}`:t,code:i}}function ai(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function qr(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function yt(r){return typeof r>"u"}function Ze(r,e){return e&&yt(r)?!0:typeof r=="string"&&Boolean(r.trim().length)}function nn(r,e){return e&&yt(r)?!0:typeof r=="number"&&!isNaN(r)}function hf(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),n=Object.keys(t);let c=!0;return Lt(n,i)?(i.forEach(y=>{const{accounts:d,methods:g,events:I}=r.namespaces[y],S=Ir(d),A=t[y];(!Lt(A.chains,S)||!Lt(A.methods,g)||!Lt(A.events,I))&&(c=!1)}),c):!1}function sn(r){return Ze(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function lf(r){if(Ze(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&sn(t)}}return!1}function ff(r){if(Ze(r,!1))try{return typeof new URL(r)<"u"}catch{return!1}return!1}function df(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function pf(r){return r==null?void 0:r.topic}function gf(r,e){let t=null;return Ze(r==null?void 0:r.publicKey,!1)||(t=J("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function kn(r){let e=!0;return ai(r)?r.length&&(e=r.every(t=>Ze(t,!1))):e=!1,e}function yf(r,e,t){let i=null;return ai(e)?e.forEach(n=>{i||(!sn(n)||!n.includes(r))&&(i=Je("UNSUPPORTED_CHAINS",`${t}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function _f(r,e){let t=null;return Object.entries(r).forEach(([i,n])=>{if(t)return;const c=yf(i,n==null?void 0:n.chains,`${e} requiredNamespace`);c&&(t=c)}),t}function bf(r,e){let t=null;return ai(r)?r.forEach(i=>{t||lf(i)||(t=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function wf(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const n=bf(i==null?void 0:i.accounts,`${e} namespace`);n&&(t=n)}),t}function mf(r,e){let t=null;return kn(r==null?void 0:r.methods)?kn(r==null?void 0:r.events)||(t=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Ta(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const n=mf(i,`${e}, namespace`);n&&(t=n)}),t}function vf(r,e){let t=null;if(r&&qr(r)){const i=Ta(r,e);i&&(t=i);const n=_f(r,e);n&&(t=n)}else t=J("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return t}function zr(r,e){let t=null;if(r&&qr(r)){const i=Ta(r,e);i&&(t=i);const n=wf(r,e);n&&(t=n)}else t=J("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Aa(r){return Ze(r.protocol,!0)}function Ef(r,e){let t=!1;return e&&!r?t=!0:r&&ai(r)&&r.length&&r.forEach(i=>{t=Aa(i)}),t}function Df(r){return typeof r=="number"}function st(r){return typeof r<"u"&&typeof r!==null}function Sf(r){return!(!r||typeof r!="object"||!r.code||!nn(r.code,!1)||!r.message||!Ze(r.message,!1))}function Of(r){return!(yt(r)||!Ze(r.method,!1))}function If(r){return!(yt(r)||yt(r.result)&&yt(r.error)||!nn(r.id,!1)||!Ze(r.jsonrpc,!1))}function xf(r){return!(yt(r)||!Ze(r.name,!1))}function Yn(r,e){return!(!sn(e)||!nf(r).includes(e))}function Pf(r,e,t){return Ze(t,!1)?sf(r,e).includes(t):!1}function Tf(r,e,t){return Ze(t,!1)?af(r,e).includes(t):!1}function Jn(r,e,t){let i=null;const n=Object.keys(r),c=Object.keys(e);return Lt(n,c)?n.forEach(y=>{if(i)return;const d=r[y].chains,g=Ir(e[y].accounts);Lt(d,g)?Lt(r[y].methods,e[y].methods)?Lt(r[y].events,e[y].events)||(i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy requiredNamespaces events for ${y}`)):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy requiredNamespaces methods for ${y}`):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy requiredNamespaces chains for ${y}`)}):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces`),i}function Af(r,e){return nn(r,!1)&&r<=e.max&&r>=e.min}const Xn=10,Nf=()=>typeof global!="undefined"&&typeof global.WebSocket!="undefined"?global.WebSocket:typeof window!="undefined"&&typeof window.WebSocket!="undefined"?window.WebSocket:require("ws"),Cf=()=>typeof window!="undefined",Ff=Nf();class Rf{constructor(e){if(this.url=e,this.events=new Tt.exports.EventEmitter,this.registering=!1,!En(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket!="undefined"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket=="undefined"){t(new Error("Connection already closed"));return}this.socket.onclose=()=>{this.onClose(),e()},this.socket.close()})}async send(e,t){typeof this.socket=="undefined"&&(this.socket=await this.register());try{this.socket.send(ji(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!En(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,n)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),n(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket=="undefined")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const n=Lo.isReactNative()?void 0:{rejectUnauthorized:!Mo(e)},c=new Ff(e,[],n);Cf()?c.onerror=y=>{const d=y;i(this.emitError(d.error))}:c.on("error",y=>{i(this.emitError(y))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data=="undefined")return;const t=typeof e.data=="string"?xs(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),n=i.message||i.toString(),c=$i(e,n);this.events.emit("payload",c)}parseError(e,t=this.url){return jo(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>Xn&&this.events.setMaxListeners(Xn)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var Ri={exports:{}};(function(r,e){var t=200,i="__lodash_hash_undefined__",n=1,c=2,y=9007199254740991,d="[object Arguments]",g="[object Array]",I="[object AsyncFunction]",S="[object Boolean]",A="[object Date]",z="[object Error]",N="[object Function]",T="[object GeneratorFunction]",B="[object Map]",M="[object Number]",K="[object Null]",_="[object Object]",D="[object Promise]",b="[object Proxy]",w="[object RegExp]",m="[object Set]",s="[object String]",h="[object Symbol]",H="[object Undefined]",o="[object WeakMap]",l="[object ArrayBuffer]",f="[object DataView]",v="[object Float32Array]",p="[object Float64Array]",u="[object Int8Array]",P="[object Int16Array]",R="[object Int32Array]",$="[object Uint8Array]",O="[object Uint8ClampedArray]",j="[object Uint16Array]",q="[object Uint32Array]",G=/[\\^$.*+?()[\]{}|]/g,V=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,Y={};Y[v]=Y[p]=Y[u]=Y[P]=Y[R]=Y[$]=Y[O]=Y[j]=Y[q]=!0,Y[d]=Y[g]=Y[l]=Y[S]=Y[f]=Y[A]=Y[z]=Y[N]=Y[B]=Y[M]=Y[_]=Y[w]=Y[m]=Y[s]=Y[o]=!1;var oe=typeof nt=="object"&&nt&&nt.Object===Object&&nt,L=typeof self=="object"&&self&&self.Object===Object&&self,U=oe||L||Function("return this")(),C=e&&!e.nodeType&&e,a=C&&!0&&r&&!r.nodeType&&r,x=a&&a.exports===C,k=x&&oe.process,X=function(){try{return k&&k.binding&&k.binding("util")}catch{}}(),le=X&&X.isTypedArray;function _e(E,F){for(var W=-1,Z=E==null?0:E.length,xe=0,ne=[];++W<Z;){var Fe=E[W];F(Fe,W,E)&&(ne[xe++]=Fe)}return ne}function de(E,F){for(var W=-1,Z=F.length,xe=E.length;++W<Z;)E[xe+W]=F[W];return E}function me(E,F){for(var W=-1,Z=E==null?0:E.length;++W<Z;)if(F(E[W],W,E))return!0;return!1}function Re(E,F){for(var W=-1,Z=Array(E);++W<E;)Z[W]=F(W);return Z}function Ae(E){return function(F){return E(F)}}function ye(E,F){return E.has(F)}function pe(E,F){return E==null?void 0:E[F]}function fe(E){var F=-1,W=Array(E.size);return E.forEach(function(Z,xe){W[++F]=[xe,Z]}),W}function ue(E,F){return function(W){return E(F(W))}}function ce(E){var F=-1,W=Array(E.size);return E.forEach(function(Z){W[++F]=Z}),W}var ae=Array.prototype,se=Function.prototype,te=Object.prototype,he=U["__core-js_shared__"],ge=se.toString,re=te.hasOwnProperty,be=function(){var E=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return E?"Symbol(src)_1."+E:""}(),we=te.toString,Ee=RegExp("^"+ge.call(re).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=x?U.Buffer:void 0,ve=U.Symbol,_t=U.Uint8Array,wt=te.propertyIsEnumerable,At=ae.splice,ht=ve?ve.toStringTag:void 0,zt=Object.getOwnPropertySymbols,or=De?De.isBuffer:void 0,Pr=ue(Object.keys,Object),Le=Jt(U,"DataView"),Ne=Jt(U,"Map"),Me=Jt(U,"Promise"),je=Jt(U,"Set"),$e=Jt(U,"WeakMap"),Ce=Jt(Object,"create"),Be=Bt(Le),Ke=Bt(Ne),qe=Bt(Me),Ve=Bt(je),Ge=Bt($e),He=ve?ve.prototype:void 0,ze=He?He.valueOf:void 0;function Pe(E){var F=-1,W=E==null?0:E.length;for(this.clear();++F<W;){var Z=E[F];this.set(Z[0],Z[1])}}function We(){this.__data__=Ce?Ce(null):{},this.size=0}function ke(E){var F=this.has(E)&&delete this.__data__[E];return this.size-=F?1:0,F}function Ga(E){var F=this.__data__;if(Ce){var W=F[E];return W===i?void 0:W}return re.call(F,E)?F[E]:void 0}function Wa(E){var F=this.__data__;return Ce?F[E]!==void 0:re.call(F,E)}function ka(E,F){var W=this.__data__;return this.size+=this.has(E)?0:1,W[E]=Ce&&F===void 0?i:F,this}Pe.prototype.clear=We,Pe.prototype.delete=ke,Pe.prototype.get=Ga,Pe.prototype.has=Wa,Pe.prototype.set=ka;function Ot(E){var F=-1,W=E==null?0:E.length;for(this.clear();++F<W;){var Z=E[F];this.set(Z[0],Z[1])}}function Ya(){this.__data__=[],this.size=0}function Ja(E){var F=this.__data__,W=Ar(F,E);if(W<0)return!1;var Z=F.length-1;return W==Z?F.pop():At.call(F,W,1),--this.size,!0}function Xa(E){var F=this.__data__,W=Ar(F,E);return W<0?void 0:F[W][1]}function Za(E){return Ar(this.__data__,E)>-1}function Qa(E,F){var W=this.__data__,Z=Ar(W,E);return Z<0?(++this.size,W.push([E,F])):W[Z][1]=F,this}Ot.prototype.clear=Ya,Ot.prototype.delete=Ja,Ot.prototype.get=Xa,Ot.prototype.has=Za,Ot.prototype.set=Qa;function Ht(E){var F=-1,W=E==null?0:E.length;for(this.clear();++F<W;){var Z=E[F];this.set(Z[0],Z[1])}}function eo(){this.size=0,this.__data__={hash:new Pe,map:new(Ne||Ot),string:new Pe}}function to(E){var F=Nr(this,E).delete(E);return this.size-=F?1:0,F}function ro(E){return Nr(this,E).get(E)}function io(E){return Nr(this,E).has(E)}function no(E,F){var W=Nr(this,E),Z=W.size;return W.set(E,F),this.size+=W.size==Z?0:1,this}Ht.prototype.clear=eo,Ht.prototype.delete=to,Ht.prototype.get=ro,Ht.prototype.has=io,Ht.prototype.set=no;function Tr(E){var F=-1,W=E==null?0:E.length;for(this.__data__=new Ht;++F<W;)this.add(E[F])}function so(E){return this.__data__.set(E,i),this}function ao(E){return this.__data__.has(E)}Tr.prototype.add=Tr.prototype.push=so,Tr.prototype.has=ao;function Nt(E){var F=this.__data__=new Ot(E);this.size=F.size}function oo(){this.__data__=new Ot,this.size=0}function co(E){var F=this.__data__,W=F.delete(E);return this.size=F.size,W}function uo(E){return this.__data__.get(E)}function ho(E){return this.__data__.has(E)}function lo(E,F){var W=this.__data__;if(W instanceof Ot){var Z=W.__data__;if(!Ne||Z.length<t-1)return Z.push([E,F]),this.size=++W.size,this;W=this.__data__=new Ht(Z)}return W.set(E,F),this.size=W.size,this}Nt.prototype.clear=oo,Nt.prototype.delete=co,Nt.prototype.get=uo,Nt.prototype.has=ho,Nt.prototype.set=lo;function fo(E,F){var W=Cr(E),Z=!W&&Po(E),xe=!W&&!Z&&ui(E),ne=!W&&!Z&&!xe&&mn(E),Fe=W||Z||xe||ne,Ye=Fe?Re(E.length,String):[],Xe=Ye.length;for(var Te in E)(F||re.call(E,Te))&&!(Fe&&(Te=="length"||xe&&(Te=="offset"||Te=="parent")||ne&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||Do(Te,Xe)))&&Ye.push(Te);return Ye}function Ar(E,F){for(var W=E.length;W--;)if(yn(E[W][0],F))return W;return-1}function po(E,F,W){var Z=F(E);return Cr(E)?Z:de(Z,W(E))}function cr(E){return E==null?E===void 0?H:K:ht&&ht in Object(E)?vo(E):xo(E)}function fn(E){return ur(E)&&cr(E)==d}function dn(E,F,W,Z,xe){return E===F?!0:E==null||F==null||!ur(E)&&!ur(F)?E!==E&&F!==F:go(E,F,W,Z,dn,xe)}function go(E,F,W,Z,xe,ne){var Fe=Cr(E),Ye=Cr(F),Xe=Fe?g:Ct(E),Te=Ye?g:Ct(F);Xe=Xe==d?_:Xe,Te=Te==d?_:Te;var lt=Xe==_,bt=Te==_,tt=Xe==Te;if(tt&&ui(E)){if(!ui(F))return!1;Fe=!0,lt=!1}if(tt&&!lt)return ne||(ne=new Nt),Fe||mn(E)?pn(E,F,W,Z,xe,ne):wo(E,F,Xe,W,Z,xe,ne);if(!(W&n)){var dt=lt&&re.call(E,"__wrapped__"),pt=bt&&re.call(F,"__wrapped__");if(dt||pt){var Ft=dt?E.value():E,It=pt?F.value():F;return ne||(ne=new Nt),xe(Ft,It,W,Z,ne)}}return tt?(ne||(ne=new Nt),mo(E,F,W,Z,xe,ne)):!1}function yo(E){if(!wn(E)||Oo(E))return!1;var F=_n(E)?Ee:V;return F.test(Bt(E))}function _o(E){return ur(E)&&bn(E.length)&&!!Y[cr(E)]}function bo(E){if(!Io(E))return Pr(E);var F=[];for(var W in Object(E))re.call(E,W)&&W!="constructor"&&F.push(W);return F}function pn(E,F,W,Z,xe,ne){var Fe=W&n,Ye=E.length,Xe=F.length;if(Ye!=Xe&&!(Fe&&Xe>Ye))return!1;var Te=ne.get(E);if(Te&&ne.get(F))return Te==F;var lt=-1,bt=!0,tt=W&c?new Tr:void 0;for(ne.set(E,F),ne.set(F,E);++lt<Ye;){var dt=E[lt],pt=F[lt];if(Z)var Ft=Fe?Z(pt,dt,lt,F,E,ne):Z(dt,pt,lt,E,F,ne);if(Ft!==void 0){if(Ft)continue;bt=!1;break}if(tt){if(!me(F,function(It,Kt){if(!ye(tt,Kt)&&(dt===It||xe(dt,It,W,Z,ne)))return tt.push(Kt)})){bt=!1;break}}else if(!(dt===pt||xe(dt,pt,W,Z,ne))){bt=!1;break}}return ne.delete(E),ne.delete(F),bt}function wo(E,F,W,Z,xe,ne,Fe){switch(W){case f:if(E.byteLength!=F.byteLength||E.byteOffset!=F.byteOffset)return!1;E=E.buffer,F=F.buffer;case l:return!(E.byteLength!=F.byteLength||!ne(new _t(E),new _t(F)));case S:case A:case M:return yn(+E,+F);case z:return E.name==F.name&&E.message==F.message;case w:case s:return E==F+"";case B:var Ye=fe;case m:var Xe=Z&n;if(Ye||(Ye=ce),E.size!=F.size&&!Xe)return!1;var Te=Fe.get(E);if(Te)return Te==F;Z|=c,Fe.set(E,F);var lt=pn(Ye(E),Ye(F),Z,xe,ne,Fe);return Fe.delete(E),lt;case h:if(ze)return ze.call(E)==ze.call(F)}return!1}function mo(E,F,W,Z,xe,ne){var Fe=W&n,Ye=gn(E),Xe=Ye.length,Te=gn(F),lt=Te.length;if(Xe!=lt&&!Fe)return!1;for(var bt=Xe;bt--;){var tt=Ye[bt];if(!(Fe?tt in F:re.call(F,tt)))return!1}var dt=ne.get(E);if(dt&&ne.get(F))return dt==F;var pt=!0;ne.set(E,F),ne.set(F,E);for(var Ft=Fe;++bt<Xe;){tt=Ye[bt];var It=E[tt],Kt=F[tt];if(Z)var vn=Fe?Z(Kt,It,tt,F,E,ne):Z(It,Kt,tt,E,F,ne);if(!(vn===void 0?It===Kt||xe(It,Kt,W,Z,ne):vn)){pt=!1;break}Ft||(Ft=tt=="constructor")}if(pt&&!Ft){var Fr=E.constructor,Rr=F.constructor;Fr!=Rr&&"constructor"in E&&"constructor"in F&&!(typeof Fr=="function"&&Fr instanceof Fr&&typeof Rr=="function"&&Rr instanceof Rr)&&(pt=!1)}return ne.delete(E),ne.delete(F),pt}function gn(E){return po(E,No,Eo)}function Nr(E,F){var W=E.__data__;return So(F)?W[typeof F=="string"?"string":"hash"]:W.map}function Jt(E,F){var W=pe(E,F);return yo(W)?W:void 0}function vo(E){var F=re.call(E,ht),W=E[ht];try{E[ht]=void 0;var Z=!0}catch{}var xe=we.call(E);return Z&&(F?E[ht]=W:delete E[ht]),xe}var Eo=zt?function(E){return E==null?[]:(E=Object(E),_e(zt(E),function(F){return wt.call(E,F)}))}:Co,Ct=cr;(Le&&Ct(new Le(new ArrayBuffer(1)))!=f||Ne&&Ct(new Ne)!=B||Me&&Ct(Me.resolve())!=D||je&&Ct(new je)!=m||$e&&Ct(new $e)!=o)&&(Ct=function(E){var F=cr(E),W=F==_?E.constructor:void 0,Z=W?Bt(W):"";if(Z)switch(Z){case Be:return f;case Ke:return B;case qe:return D;case Ve:return m;case Ge:return o}return F});function Do(E,F){return F=F==null?y:F,!!F&&(typeof E=="number"||Q.test(E))&&E>-1&&E%1==0&&E<F}function So(E){var F=typeof E;return F=="string"||F=="number"||F=="symbol"||F=="boolean"?E!=="__proto__":E===null}function Oo(E){return!!be&&be in E}function Io(E){var F=E&&E.constructor,W=typeof F=="function"&&F.prototype||te;return E===W}function xo(E){return we.call(E)}function Bt(E){if(E!=null){try{return ge.call(E)}catch{}try{return E+""}catch{}}return""}function yn(E,F){return E===F||E!==E&&F!==F}var Po=fn(function(){return arguments}())?fn:function(E){return ur(E)&&re.call(E,"callee")&&!wt.call(E,"callee")},Cr=Array.isArray;function To(E){return E!=null&&bn(E.length)&&!_n(E)}var ui=or||Fo;function Ao(E,F){return dn(E,F)}function _n(E){if(!wn(E))return!1;var F=cr(E);return F==N||F==T||F==I||F==b}function bn(E){return typeof E=="number"&&E>-1&&E%1==0&&E<=y}function wn(E){var F=typeof E;return E!=null&&(F=="object"||F=="function")}function ur(E){return E!=null&&typeof E=="object"}var mn=le?Ae(le):_o;function No(E){return To(E)?fo(E):bo(E)}function Co(){return[]}function Fo(){return!1}r.exports=Ao})(Ri,Ri.exports);var Uf=Ri.exports;function Lf(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var c=r.charAt(n),y=c.charCodeAt(0);if(t[y]!==255)throw new TypeError(c+" is ambiguous");t[y]=n}var d=r.length,g=r.charAt(0),I=Math.log(d)/Math.log(256),S=Math.log(256)/Math.log(d);function A(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var B=0,M=0,K=0,_=T.length;K!==_&&T[K]===0;)K++,B++;for(var D=(_-K)*S+1>>>0,b=new Uint8Array(D);K!==_;){for(var w=T[K],m=0,s=D-1;(w!==0||m<M)&&s!==-1;s--,m++)w+=256*b[s]>>>0,b[s]=w%d>>>0,w=w/d>>>0;if(w!==0)throw new Error("Non-zero carry");M=m,K++}for(var h=D-M;h!==D&&b[h]===0;)h++;for(var H=g.repeat(B);h<D;++h)H+=r.charAt(b[h]);return H}function z(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var B=0;if(T[B]!==" "){for(var M=0,K=0;T[B]===g;)M++,B++;for(var _=(T.length-B)*I+1>>>0,D=new Uint8Array(_);T[B];){var b=t[T.charCodeAt(B)];if(b===255)return;for(var w=0,m=_-1;(b!==0||w<K)&&m!==-1;m--,w++)b+=d*D[m]>>>0,D[m]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");K=w,B++}if(T[B]!==" "){for(var s=_-K;s!==_&&D[s]===0;)s++;for(var h=new Uint8Array(M+(_-s)),H=M;s!==_;)h[H++]=D[s++];return h}}}function N(T){var B=z(T);if(B)return B;throw new Error(`Non-${e} character`)}return{encode:A,decodeUnsafe:z,decode:N}}var Mf=Lf,jf=Mf;const Na=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},$f=r=>new TextEncoder().encode(r),zf=r=>new TextDecoder().decode(r);class Hf{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Bf{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ca(this,e)}}class Kf{constructor(e){this.decoders=e}or(e){return Ca(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ca=(r,e)=>new Kf({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class qf{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new Hf(e,t,i),this.decoder=new Bf(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const oi=({name:r,prefix:e,encode:t,decode:i})=>new qf(r,e,t,i),xr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:n}=jf(t,e);return oi({prefix:r,name:e,encode:i,decode:c=>Na(n(c))})},Vf=(r,e,t,i)=>{const n={};for(let S=0;S<e.length;++S)n[e[S]]=S;let c=r.length;for(;r[c-1]==="=";)--c;const y=new Uint8Array(c*t/8|0);let d=0,g=0,I=0;for(let S=0;S<c;++S){const A=n[r[S]];if(A===void 0)throw new SyntaxError(`Non-${i} character`);g=g<<t|A,d+=t,d>=8&&(d-=8,y[I++]=255&g>>d)}if(d>=t||255&g<<8-d)throw new SyntaxError("Unexpected end of data");return y},Gf=(r,e,t)=>{const i=e[e.length-1]==="=",n=(1<<t)-1;let c="",y=0,d=0;for(let g=0;g<r.length;++g)for(d=d<<8|r[g],y+=8;y>t;)y-=t,c+=e[n&d>>y];if(y&&(c+=e[n&d<<t-y]),i)for(;c.length*t&7;)c+="=";return c},et=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>oi({prefix:e,name:r,encode(n){return Gf(n,i,t)},decode(n){return Vf(n,i,t,r)}}),Wf=oi({prefix:"\0",name:"identity",encode:r=>zf(r),decode:r=>$f(r)});var kf=Object.freeze({__proto__:null,identity:Wf});const Yf=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Jf=Object.freeze({__proto__:null,base2:Yf});const Xf=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Zf=Object.freeze({__proto__:null,base8:Xf});const Qf=xr({prefix:"9",name:"base10",alphabet:"0123456789"});var ed=Object.freeze({__proto__:null,base10:Qf});const td=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rd=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var id=Object.freeze({__proto__:null,base16:td,base16upper:rd});const nd=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sd=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ad=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),od=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),cd=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ud=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hd=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ld=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fd=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dd=Object.freeze({__proto__:null,base32:nd,base32upper:sd,base32pad:ad,base32padupper:od,base32hex:cd,base32hexupper:ud,base32hexpad:hd,base32hexpadupper:ld,base32z:fd});const pd=xr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gd=xr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var yd=Object.freeze({__proto__:null,base36:pd,base36upper:gd});const _d=xr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bd=xr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var wd=Object.freeze({__proto__:null,base58btc:_d,base58flickr:bd});const md=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vd=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ed=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Dd=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Sd=Object.freeze({__proto__:null,base64:md,base64pad:vd,base64url:Ed,base64urlpad:Dd});const Fa=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Od=Fa.reduce((r,e,t)=>(r[t]=e,r),[]),Id=Fa.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function xd(r){return r.reduce((e,t)=>(e+=Od[t],e),"")}function Pd(r){const e=[];for(const t of r){const i=Id[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Td=oi({prefix:"\u{1F680}",name:"base256emoji",encode:xd,decode:Pd});var Ad=Object.freeze({__proto__:null,base256emoji:Td}),Nd=Ra,Zn=128,Cd=127,Fd=~Cd,Rd=Math.pow(2,31);function Ra(r,e,t){e=e||[],t=t||0;for(var i=t;r>=Rd;)e[t++]=r&255|Zn,r/=128;for(;r&Fd;)e[t++]=r&255|Zn,r>>>=7;return e[t]=r|0,Ra.bytes=t-i+1,e}var Ud=Ui,Ld=128,Qn=127;function Ui(r,i){var t=0,i=i||0,n=0,c=i,y,d=r.length;do{if(c>=d)throw Ui.bytes=0,new RangeError("Could not decode varint");y=r[c++],t+=n<28?(y&Qn)<<n:(y&Qn)*Math.pow(2,n),n+=7}while(y>=Ld);return Ui.bytes=c-i,t}var Md=Math.pow(2,7),jd=Math.pow(2,14),$d=Math.pow(2,21),zd=Math.pow(2,28),Hd=Math.pow(2,35),Bd=Math.pow(2,42),Kd=Math.pow(2,49),qd=Math.pow(2,56),Vd=Math.pow(2,63),Gd=function(r){return r<Md?1:r<jd?2:r<$d?3:r<zd?4:r<Hd?5:r<Bd?6:r<Kd?7:r<qd?8:r<Vd?9:10},Wd={encode:Nd,decode:Ud,encodingLength:Gd},Ua=Wd;const es=(r,e,t=0)=>(Ua.encode(r,e,t),e),ts=r=>Ua.encodingLength(r),Li=(r,e)=>{const t=e.byteLength,i=ts(r),n=i+ts(t),c=new Uint8Array(n+t);return es(r,c,0),es(t,c,i),c.set(e,n),new kd(r,t,e,c)};class kd{constructor(e,t,i,n){this.code=e,this.size=t,this.digest=i,this.bytes=n}}const La=({name:r,code:e,encode:t})=>new Yd(r,e,t);class Yd{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Li(this.code,t):t.then(i=>Li(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ma=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Jd=La({name:"sha2-256",code:18,encode:Ma("SHA-256")}),Xd=La({name:"sha2-512",code:19,encode:Ma("SHA-512")});var Zd=Object.freeze({__proto__:null,sha256:Jd,sha512:Xd});const ja=0,Qd="identity",$a=Na,ep=r=>Li(ja,$a(r)),tp={code:ja,name:Qd,encode:$a,digest:ep};var rp=Object.freeze({__proto__:null,identity:tp});new TextEncoder,new TextDecoder;const rs={...kf,...Jf,...Zf,...ed,...id,...dd,...yd,...wd,...Sd,...Ad};({...Zd,...rp});function ip(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function za(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const is=za("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),pi=za("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=ip(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),np={utf8:is,"utf-8":is,hex:rs.base16,latin1:pi,ascii:pi,binary:pi,...rs};function sp(r,e="utf8"){const t=np[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}const Ha="wc",ap=2,an="core",Mt=`${Ha}@${2}:${an}:`,op={name:an,logger:"error"},cp={database:":memory:"},up="crypto",ns="client_ed25519_seed",hp=ee.ONE_DAY,lp="keychain",fp="0.3",dp="messages",pp="0.3",gp=ee.SIX_HOURS,yp="publisher",Ba="irn",_p="error",bp="wss://relay.walletconnect.com",wp="relayer",it={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},mp="_subscription",Lr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ss=ee.ONE_SECOND,vp="2.3.3",Ep="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Dp="subscription",Sp="0.3",Op=ee.FIVE_SECONDS*1e3,Ip="pairing",xp="0.3",hr={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Pp="history",Tp="0.3",Ap="expirer",gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Np="0.3";class Cp{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=lp,this.version=fp,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:c}=J("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Sa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oa(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Fp{constructor(e,t,i){this.core=e,this.logger=t,this.name=up,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),c=Fn(n);return ha(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Sl();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const c=await this.getClientSeed(),y=Fn(c),d=Ai();return await jh(d,n,hp,y)},this.generateSharedKey=(n,c,y)=>{this.isInitialized();const d=this.getPrivateKey(n),g=Ol(d,c);return this.setSymKey(g,y)},this.setSymKey=async(n,c)=>{this.isInitialized();const y=c||Il(n);return await this.keychain.set(y,n),y},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,c,y)=>{this.isInitialized();const d=Ea(y),g=ji(c);if(Bn(d)){const z=d.senderPublicKey,N=d.receiverPublicKey;n=await this.generateSharedKey(z,N)}const I=this.getSymKey(n),{type:S,senderPublicKey:A}=d;return Pl({type:S,symKey:I,message:g,senderPublicKey:A})},this.decode=async(n,c,y)=>{this.isInitialized();const d=Nl(c,y);if(Bn(d)){const S=d.receiverPublicKey,A=d.senderPublicKey;n=await this.generateSharedKey(S,A)}const g=this.getSymKey(n),I=Tl({symKey:g,encoded:c});return xs(I)},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.keychain=i||new Cp(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const t=rn(e);return Or(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ns)}catch{e=Ai(),await this.keychain.set(ns,e)}return sp(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Rp extends Dc{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=dp,this.version=pp,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const c=Ni(n);let y=this.messages.get(i);return typeof y>"u"&&(y={}),typeof y[c]<"u"||(y[c]=n,this.messages.set(i,y),await this.persist()),c},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const c=this.get(i),y=Ni(n);return typeof c[y]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=t}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Sa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oa(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Up extends Sc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new Tt.exports.EventEmitter,this.name=yp,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,n,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:c}});try{const y=(c==null?void 0:c.ttl)||gp,d=Ci(c),g=(c==null?void 0:c.prompt)||!1,I=(c==null?void 0:c.tag)||0,S={topic:i,message:n,opts:{ttl:y,relay:d,prompt:g,tag:I}},A=Ni(n);this.queue.set(A,S);try{await await Ia(this.rpcPublish(i,n,y,d,g,I),this.publishTimeout),this.relayer.events.emit(it.publish,S)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(it.connection_stalled);return}this.onPublish(A,S),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:c}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,t,i,n,c,y){var d,g,I,S;const A={method:Fi(n.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:c,tag:y}};return yt((d=A.params)==null?void 0:d.prompt)&&((g=A.params)==null||delete g.prompt),yt((I=A.params)==null?void 0:I.tag)&&((S=A.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:A}),this.relayer.provider.request(A)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:n}=e;await this.publish(t,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(wr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Lp{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const n=i.filter(c=>c!==t);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Mp=Object.defineProperty,jp=Object.defineProperties,$p=Object.getOwnPropertyDescriptors,as=Object.getOwnPropertySymbols,zp=Object.prototype.hasOwnProperty,Hp=Object.prototype.propertyIsEnumerable,os=(r,e,t)=>e in r?Mp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mr=(r,e)=>{for(var t in e||(e={}))zp.call(e,t)&&os(r,t,e[t]);if(as)for(var t of as(e))Hp.call(e,t)&&os(r,t,e[t]);return r},gi=(r,e)=>jp(r,$p(e));class Bp extends xc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Lp,this.events=new Tt.exports.EventEmitter,this.name=Dp,this.version=Sp,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Mt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const c=Ci(n),y={topic:i,relay:c};this.pending.set(i,y);const d=await this.rpcSubscribe(i,c);return this.onSubscribe(d,y),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),d}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,n)=>{this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,c)=>{const y=new ee.Watch;y.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(d),y.stop(this.pendingSubscriptionWatchLabel),n(!0)),y.elapsed(this.pendingSubscriptionWatchLabel)>=Op&&(clearInterval(d),y.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pendingSubInterval)}),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const n=Ci(i);await this.rpcUnsubscribe(e,t,n);const c=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,t){const i={method:Fi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Ia(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(it.connection_stalled)}return n}rpcUnsubscribe(e,t,i){const n={method:Fi(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}onSubscribe(e,t){this.setSubscription(e,gi(Mr({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,gi(Mr({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Mr({},t)),this.topicMap.set(t.topic,e),this.events.emit(Et.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Et.deleted,gi(Mr({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:i}=e,n={topic:t,relay:i};this.pending.set(n.topic,n);const c=await this.rpcSubscribe(n.topic,n.relay);this.onResubscribe(c,n)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(wr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(it.connect,async()=>{await this.onConnect()}),this.relayer.on(it.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const t=Et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const t=Et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Kp=Object.defineProperty,cs=Object.getOwnPropertySymbols,qp=Object.prototype.hasOwnProperty,Vp=Object.prototype.propertyIsEnumerable,us=(r,e,t)=>e in r?Kp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gp=(r,e)=>{for(var t in e||(e={}))qp.call(e,t)&&us(r,t,e[t]);if(cs)for(var t of cs(e))Vp.call(e,t)&&us(r,t,e[t]);return r};class Wp extends Oc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Tt.exports.EventEmitter,this.name=wp,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):_r(Se.getDefaultLoggerOptions({level:e.logger||_p})),this.messages=new Rp(this.logger,e.core),this.subscriber=new Bp(this,this.logger),this.publisher=new Up(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||bp,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){this.isInitialized();let i="";return await Promise.all([new Promise(n=>{this.subscriber.once(Et.created,c=>{c.topic===e&&n()})}),new Promise(async n=>{i=await this.subscriber.subscribe(e,t),n()})]),i}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(it.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Et.resubscribed,()=>{t()})}),await Promise.race([this.provider.connect(),new Promise((t,i)=>this.once(it.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(t){const i=t;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(it.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(t=>setTimeout(t,ss)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new yr(new Rf(Vl({sdkVersion:vp,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),zi(e)){if(!e.method.endsWith(mp))return;const t=e.params,{topic:i,message:n}=t.data,c={topic:i,message:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Gp({type:"event",event:t.id},c)),this.events.emit(t.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(it.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Hi(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Lr.payload,e=>this.onProviderPayload(e)),this.provider.on(Lr.connect,()=>{this.events.emit(it.connect)}),this.provider.on(Lr.disconnect,()=>{this.events.emit(it.disconnect),this.attemptToReconnect()}),this.provider.on(Lr.error,e=>this.events.emit(it.error,e)),this.events.on(it.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},ee.toMiliseconds(ss))}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var kp=Object.defineProperty,hs=Object.getOwnPropertySymbols,Yp=Object.prototype.hasOwnProperty,Jp=Object.prototype.propertyIsEnumerable,ls=(r,e,t)=>e in r?kp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fs=(r,e)=>{for(var t in e||(e={}))Yp.call(e,t)&&ls(r,t,e[t]);if(hs)for(var t of hs(e))Jp.call(e,t)&&ls(r,t,e[t]);return r};class ci extends Ic{constructor(e,t,i,n=Mt,c=void 0){super(e,t,i,n),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=Ep,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(y=>{df(y)?this.map.set(y.id,y):pf(y)?this.map.set(y.topic,y):this.getKey&&y!==null&&!yt(y)&&this.map.set(this.getKey(y),y)}),this.cached=[],this.initialized=!0)},this.set=async(y,d)=>{this.isInitialized(),this.map.has(y)?await this.update(y,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:y,value:d}),this.map.set(y,d),await this.persist())},this.get=y=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:y}),this.getData(y)),this.getAll=y=>(this.isInitialized(),y?this.values.filter(d=>Object.keys(y).every(g=>Uf(d[g],y[g]))):this.values),this.update=async(y,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:y,update:d});const g=fs(fs({},this.getData(y)),d);this.map.set(y,g),await this.persist()},this.delete=async(y,d)=>{this.isInitialized(),this.map.has(y)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:y,reason:d}),this.map.delete(y),await this.persist())},this.logger=Se.generateChildLogger(t,this.name),this.storagePrefix=n,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Xp{constructor(e,t){this.core=e,this.logger=t,this.name=Ip,this.version=xp,this.events=new Mi,this.initialized=!1,this.storagePrefix=Mt,this.ignoredPayloadTypes=[kt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ai(),n=await this.core.crypto.setSymKey(i),c=Dt(ee.FIVE_MINUTES),y={protocol:Ba},d={topic:n,expiry:c,relay:y,active:!1},g=rf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:y});return await this.pairings.set(n,d),await this.core.relayer.subscribe(n),this.core.expirer.set(n,c),{topic:n,uri:g}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:c,relay:y}=ef(i.uri),d=Dt(ee.FIVE_MINUTES),g={topic:n,relay:y,expiry:d,active:!1};return await this.pairings.set(n,g),await this.core.crypto.setSymKey(c,n),await this.core.relayer.subscribe(n,{relay:y}),this.core.expirer.set(n,d),i.activatePairing&&await this.activate({topic:n}),g},this.activate=async({topic:i})=>{this.isInitialized();const n=Dt(ee.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const c=await this.sendRequest(n,"wc_pairingPing",{}),{done:y,resolve:d,reject:g}=qt();this.events.once(Ue("pairing_ping",c),({error:I})=>{I?g(I):d()}),await y()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,c)=>{const y=Bi(n,c),d=await this.core.crypto.encode(i,y),g=hr[n].req;return this.core.history.set(i,y),await this.core.relayer.publish(i,d,g),y.id},this.sendResult=async(i,n,c)=>{const y=Hi(i,c),d=await this.core.crypto.encode(n,y),g=await this.core.history.get(n,i),I=hr[g.request.method].res;await this.core.relayer.publish(n,d,I),await this.core.history.resolve(y)},this.sendError=async(i,n,c)=>{const y=$i(i,c),d=await this.core.crypto.encode(n,y),g=await this.core.history.get(n,i),I=hr[g.request.method]?hr[g.request.method].res:hr.unregistered_method.res;await this.core.relayer.publish(n,d,I),await this.core.history.resolve(y)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Ut(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:c}=i,y=c.method;if(this.pairings.keys.includes(n))switch(y){case"wc_pairingPing":return this.onPairingPingRequest(n,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,c);default:return this.onUnknownRpcMethodRequest(n,c)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:c}=i,y=(await this.core.history.get(n,c.id)).request.method;if(this.pairings.keys.includes(n))switch(y){case"wc_pairingPing":return this.onPairingPingResponse(n,c);default:return this.onUnknownRpcMethodResponse(y)}},this.onPairingPingRequest=async(i,n)=>{const{id:c}=n;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(y){await this.sendError(c,i,y),this.logger.error(y)}},this.onPairingPingResponse=(i,n)=>{const{id:c}=n;setTimeout(()=>{Rt(n)?this.events.emit(Ue("pairing_ping",c),{}):Pt(n)&&this.events.emit(Ue("pairing_ping",c),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:c}=n;try{this.isValidDisconnect({topic:i}),await this.sendResult(c,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(y){await this.sendError(c,i,y),this.logger.error(y)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:c,method:y}=n;try{if(this.registeredMethods.includes(y))return;const d=Je("WC_METHOD_UNSUPPORTED",y);await this.sendError(c,i,d),this.logger.error(d)}catch(d){await this.sendError(c,i,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!st(i)){const{message:n}=J("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!ff(i.uri)){const{message:n}=J("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!st(i)){const{message:c}=J("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!st(i)){const{message:c}=J("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:n}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=J("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.pairings=new ci(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(it.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(t,i);zi(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):Ps(n)&&(await this.core.history.resolve(n),this.onRelayEventResponse({topic:t,payload:n}))})}registerExpirerEvents(){this.core.expirer.on(gt.expired,async e=>{const{topic:t}=Pa(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class Zp extends Ec{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new Tt.exports.EventEmitter,this.name=Pp,this.version=Tp,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:c}),this.records.has(n.id))return;const y={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:c};this.records.set(y.id,y),this.events.emit(vt.created,y)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Pt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(vt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(c=>{if(c.topic===i){if(typeof n<"u"&&c.id!==n)return;this.records.delete(c.id),this.events.emit(vt.deleted,c)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Bi(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(vt.created,e=>{const t=vt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.updated,e=>{const t=vt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.deleted,e=>{const t=vt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Qp extends Pc{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new Tt.exports.EventEmitter,this.name=Ap,this.version=Np,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const c=this.formatTarget(i),y={target:c,expiry:n};this.expirations.set(c,y),this.checkExpiry(c,y),this.events.emit(gt.created,{target:c,expiration:y})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),c=this.getExpiration(n);this.expirations.delete(n),this.events.emit(gt.deleted,{target:n,expiration:c})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Gl(e);if(typeof e=="number")return Wl(e);const{message:t}=J("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;ee.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(gt.expired,{target:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(wr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(gt.created,e=>{const t=gt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.expired,e=>{const t=gt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.deleted,e=>{const t=gt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var eg=Object.defineProperty,ds=Object.getOwnPropertySymbols,tg=Object.prototype.hasOwnProperty,rg=Object.prototype.propertyIsEnumerable,ps=(r,e,t)=>e in r?eg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gs=(r,e)=>{for(var t in e||(e={}))tg.call(e,t)&&ps(r,t,e[t]);if(ds)for(var t of ds(e))rg.call(e,t)&&ps(r,t,e[t]);return r};class on extends vc{constructor(e){super(e),this.protocol=Ha,this.version=ap,this.name=an,this.events=new Tt.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:_r(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||op.logger}));this.logger=Se.generateChildLogger(t,this.name),this.heartbeat=new wr.HeartBeat,this.crypto=new Fp(this,this.logger,e==null?void 0:e.keychain),this.history=new Zp(this,this.logger),this.expirer=new Qp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ac(gs(gs({},cp),e==null?void 0:e.storageOptions)),this.relayer=new Wp({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new Xp(this,this.logger)}static async init(e){const t=new on(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const ig=on,Ka="wc",qa=2,Va="client",cn=`${Ka}@${qa}:${Va}:`,yi={name:Va,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},ng="proposal",sg="session",jr=ee.SEVEN_DAYS,ag="engine",lr={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1115}}},_i={min:ee.FIVE_MINUTES,max:ee.SEVEN_DAYS},og="request";var cg=Object.defineProperty,ug=Object.defineProperties,hg=Object.getOwnPropertyDescriptors,ys=Object.getOwnPropertySymbols,lg=Object.prototype.hasOwnProperty,fg=Object.prototype.propertyIsEnumerable,_s=(r,e,t)=>e in r?cg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xt=(r,e)=>{for(var t in e||(e={}))lg.call(e,t)&&_s(r,t,e[t]);if(ys)for(var t of ys(e))fg.call(e,t)&&_s(r,t,e[t]);return r},bi=(r,e)=>ug(r,hg(e));class dg extends Ac{constructor(e){super(e),this.name=ag,this.events=new Mi,this.initialized=!1,this.ignoredPayloadTypes=[kt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(lr)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized(),await this.isValidConnect(t);const{pairingTopic:i,requiredNamespaces:n,relays:c}=t;let y=i,d,g=!1;if(y&&(g=this.client.core.pairing.pairings.get(y).active),!y||!g){const{topic:M,uri:K}=await this.client.core.pairing.create();y=M,d=K}const I=await this.client.core.crypto.generateKeyPair(),S={requiredNamespaces:n,relays:c!=null?c:[{protocol:Ba}],proposer:{publicKey:I,metadata:this.client.metadata}},{reject:A,resolve:z,done:N}=qt();if(this.events.once(Ue("session_connect"),async({error:M,session:K})=>{if(M)A(M);else if(K){K.self.publicKey=I;const _=bi(xt({},K),{requiredNamespaces:K.requiredNamespaces});await this.client.session.set(K.topic,_),await this.setExpiry(K.topic,K.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:K.peer.metadata}),z(_)}}),!y){const{message:M}=J("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(M)}const T=await this.sendRequest(y,"wc_sessionPropose",S),B=Dt(ee.FIVE_MINUTES);return await this.setProposal(T,xt({id:T,expiry:B},S)),{uri:d,approval:N}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:i,relayProtocol:n,namespaces:c}=t,y=this.client.proposal.get(i);let{pairingTopic:d,proposer:g,requiredNamespaces:I}=y;qr(I)||(I=of(c,"approve()"),this.client.proposal.set(i,bi(xt({},y),{requiredNamespaces:I})));const S=await this.client.core.crypto.generateKeyPair(),A=g.publicKey,z=await this.client.core.crypto.generateSharedKey(S,A),N={relay:{protocol:n!=null?n:"irn"},namespaces:c,requiredNamespaces:I,controller:{publicKey:S,metadata:this.client.metadata},expiry:Dt(jr)};await this.client.core.relayer.subscribe(z);const T=await this.sendRequest(z,"wc_sessionSettle",N),{done:B,resolve:M,reject:K}=qt();this.events.once(Ue("session_approve",T),({error:D})=>{D?K(D):M(this.client.session.get(z))});const _=bi(xt({},N),{topic:z,acknowledged:!1,self:N.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:S});return await this.client.session.set(z,_),await this.setExpiry(z,Dt(jr)),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:_.peer.metadata}),d&&i&&(await this.sendResult(i,d,{relay:{protocol:n!=null?n:"irn"},responderPublicKey:S}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d})),{topic:z,acknowledged:B}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:i,reason:n}=t,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,n),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:i,namespaces:n}=t,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:y,resolve:d,reject:g}=qt();return this.events.once(Ue("session_update",c),({error:I})=>{I?g(I):d()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:y}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:i}=t,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:y,reject:d}=qt();return this.events.once(Ue("session_extend",n),({error:g})=>{g?d(g):y()}),await this.setExpiry(i,Dt(jr)),{acknowledged:c}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:i,request:n,topic:c,expiry:y}=t,d=await this.sendRequest(c,"wc_sessionRequest",{request:n,chainId:i},y),{done:g,resolve:I,reject:S}=qt(y);return this.events.once(Ue("session_request",d),({error:A,result:z})=>{A?S(A):I(z)}),await g()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:n}=t,{id:c}=n;Rt(n)?await this.sendResult(c,i,n.result):Pt(n)&&await this.sendError(c,i,n.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:i}=t;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:y,reject:d}=qt();this.events.once(Ue("session_ping",n),({error:g})=>{g?d(g):y()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:i,event:n,chainId:c}=t;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:c})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:i}=t;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(i=>hf(i,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,i)=>{const{self:n}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.deleteSymKey(t),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,i)=>{await Promise.all([this.client.proposal.delete(t,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),n?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,i)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:i}),this.client.core.expirer.set(t,i)},this.setProposal=async(t,i)=>{await this.client.proposal.set(t,i),this.client.core.expirer.set(t,i.expiry)},this.setPendingSessionRequest=async t=>{const i=lr.wc_sessionRequest.req.ttl,{id:n,topic:c,params:y}=t;await this.client.pendingRequest.set(n,{id:n,topic:c,params:y}),i&&this.client.core.expirer.set(n,Dt(i))},this.sendRequest=async(t,i,n,c)=>{const y=Bi(i,n),d=await this.client.core.crypto.encode(t,y),g=lr[i].req;return c&&(g.ttl=c),this.client.core.history.set(t,y),this.client.core.relayer.publish(t,d,g),y.id},this.sendResult=async(t,i,n)=>{const c=Hi(t,n),y=await this.client.core.crypto.encode(i,c),d=await this.client.core.history.get(i,t),g=lr[d.request.method].res;this.client.core.relayer.publish(i,y,g),await this.client.core.history.resolve(c)},this.sendError=async(t,i,n)=>{const c=$i(t,n),y=await this.client.core.crypto.encode(i,c),d=await this.client.core.history.get(i,t),g=lr[d.request.method].res;this.client.core.relayer.publish(i,y,g),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],i=[];this.client.session.getAll().forEach(n=>{Ut(n.expiry)&&t.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Ut(n.expiry)&&i.push(n.id)}),await Promise.all([...t.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=t=>{const{topic:i,payload:n}=t,c=n.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:n}=t,c=(await this.client.core.history.get(i,n.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(t,i)=>{const{params:n,id:c}=i;try{this.isValidConnect(xt({},i.params));const y=Dt(ee.FIVE_MINUTES),d=xt({id:c,pairingTopic:t,expiry:y},n);await this.setProposal(c,d),this.client.events.emit("session_proposal",{id:c,params:d})}catch(y){await this.sendError(c,t,y),this.client.logger.error(y)}},this.onSessionProposeResponse=async(t,i)=>{const{id:n}=i;if(Rt(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const y=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:y});const d=y.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const g=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:g});const I=await this.client.core.crypto.generateSharedKey(d,g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:I});const S=await this.client.core.relayer.subscribe(I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:S}),await this.client.core.pairing.activate({topic:t})}else Pt(i)&&(await this.client.proposal.delete(n,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(t,i)=>{const{id:n,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:y,controller:d,expiry:g,namespaces:I,requiredNamespaces:S}=i.params,A={topic:t,relay:y,expiry:g,namespaces:I,acknowledged:!0,requiredNamespaces:S,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}};await this.sendResult(i.id,t,!0),this.events.emit(Ue("session_connect"),{session:A})}catch(y){await this.sendError(n,t,y),this.client.logger.error(y)}},this.onSessionSettleResponse=async(t,i)=>{const{id:n}=i;Rt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ue("session_approve",n),{})):Pt(i)&&(await this.client.session.delete(t,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(t,i)=>{const{params:n,id:c}=i;try{this.isValidUpdate(xt({topic:t},n)),await this.client.session.update(t,{namespaces:n.namespaces}),await this.sendResult(c,t,!0),this.client.events.emit("session_update",{id:c,topic:t,params:n})}catch(y){await this.sendError(c,t,y),this.client.logger.error(y)}},this.onSessionUpdateResponse=(t,i)=>{const{id:n}=i;Rt(i)?this.events.emit(Ue("session_update",n),{}):Pt(i)&&this.events.emit(Ue("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(t,i)=>{const{id:n}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Dt(jr)),await this.sendResult(n,t,!0),this.client.events.emit("session_extend",{id:n,topic:t})}catch(c){await this.sendError(n,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,i)=>{const{id:n}=i;Rt(i)?this.events.emit(Ue("session_extend",n),{}):Pt(i)&&this.events.emit(Ue("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(t,i)=>{const{id:n}=i;try{this.isValidPing({topic:t}),await this.sendResult(n,t,!0),this.client.events.emit("session_ping",{id:n,topic:t})}catch(c){await this.sendError(n,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,i)=>{const{id:n}=i;setTimeout(()=>{Rt(i)?this.events.emit(Ue("session_ping",n),{}):Pt(i)&&this.events.emit(Ue("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(t,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),this.client.core.relayer.once(it.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(n,t,!0),this.client.events.emit("session_delete",{id:n,topic:t})}catch(c){await this.sendError(n,t,c),this.client.logger.error(c)}},this.onSessionRequest=async(t,i)=>{const{id:n,params:c}=i;try{this.isValidRequest(xt({topic:t},c)),await this.setPendingSessionRequest({id:n,topic:t,params:c}),this.client.events.emit("session_request",{id:n,topic:t,params:c})}catch(y){await this.sendError(n,t,y),this.client.logger.error(y)}},this.onSessionRequestResponse=(t,i)=>{const{id:n}=i;Rt(i)?this.events.emit(Ue("session_request",n),{result:i.result}):Pt(i)&&this.events.emit(Ue("session_request",n),{error:i.error})},this.onSessionEventRequest=async(t,i)=>{const{id:n,params:c}=i;try{this.isValidEmit(xt({topic:t},c)),this.client.events.emit("session_event",{id:n,topic:t,params:c})}catch(y){await this.sendError(n,t,y),this.client.logger.error(y)}},this.isValidConnect=async t=>{if(!st(t)){const{message:d}=J("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(d)}const{pairingTopic:i,requiredNamespaces:n,relays:c}=t;if(yt(i)||await this.isValidPairingTopic(i),!yt(n)&&qr(n)===0)return;const y=vf(n,"connect()");if(y)throw new Error(y.message);if(!Ef(c,!0)){const{message:d}=J("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(d)}},this.isValidApprove=async t=>{if(!st(t))throw new Error(J("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:n,relayProtocol:c}=t;await this.isValidProposalId(i);const y=this.client.proposal.get(i),d=zr(n,"approve()");if(d)throw new Error(d.message);const g=Jn(y.requiredNamespaces,n,"update()");if(g)throw new Error(g.message);if(!Ze(c,!0)){const{message:I}=J("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(I)}},this.isValidReject=async t=>{if(!st(t)){const{message:c}=J("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:i,reason:n}=t;if(await this.isValidProposalId(i),!Sf(n)){const{message:c}=J("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!st(t)){const{message:I}=J("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(I)}const{relay:i,controller:n,namespaces:c,expiry:y}=t;if(!Aa(i)){const{message:I}=J("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(I)}const d=gf(n,"onSessionSettleRequest()");if(d)throw new Error(d.message);const g=zr(c,"onSessionSettleRequest()");if(g)throw new Error(g.message);if(Ut(y)){const{message:I}=J("EXPIRED","onSessionSettleRequest()");throw new Error(I)}},this.isValidUpdate=async t=>{if(!st(t)){const{message:g}=J("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(g)}const{topic:i,namespaces:n}=t;await this.isValidSessionTopic(i);const c=this.client.session.get(i),y=zr(n,"update()");if(y)throw new Error(y.message);const d=Jn(c.requiredNamespaces,n,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async t=>{if(!st(t)){const{message:n}=J("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(n)}const{topic:i}=t;await this.isValidSessionTopic(i)},this.isValidRequest=async t=>{if(!st(t)){const{message:g}=J("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(g)}const{topic:i,request:n,chainId:c,expiry:y}=t;await this.isValidSessionTopic(i);const{namespaces:d}=this.client.session.get(i);if(!Yn(d,c)){const{message:g}=J("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(g)}if(!Of(n)){const{message:g}=J("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(g)}if(!Pf(d,c,n.method)){const{message:g}=J("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(g)}if(y&&!Af(y,_i)){const{message:g}=J("MISSING_OR_INVALID",`request() expiry: ${y}. Expiry must be a number (in seconds) between ${_i.min} and ${_i.max}`);throw new Error(g)}},this.isValidRespond=async t=>{if(!st(t)){const{message:c}=J("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:i,response:n}=t;if(await this.isValidSessionTopic(i),!If(n)){const{message:c}=J("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!st(t)){const{message:n}=J("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(n)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async t=>{if(!st(t)){const{message:d}=J("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(d)}const{topic:i,event:n,chainId:c}=t;await this.isValidSessionTopic(i);const{namespaces:y}=this.client.session.get(i);if(!Yn(y,c)){const{message:d}=J("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(d)}if(!xf(n)){const{message:d}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(d)}if(!Tf(y,c,n.name)){const{message:d}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(d)}},this.isValidDisconnect=async t=>{if(!st(t)){const{message:n}=J("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(n)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(it.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(t,i);zi(n)?(this.client.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):Ps(n)&&(await this.client.core.history.resolve(n),this.onRelayEventResponse({topic:t,payload:n}))})}registerExpirerEvents(){this.client.core.expirer.on(gt.expired,async e=>{const{topic:t,id:i}=Pa(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,J("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:t}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=J("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:t}=J("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=J("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=J("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:t}=J("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=J("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Df(e)){const{message:t}=J("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=J("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Ut(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=J("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class pg extends ci{constructor(e,t){super(e,t,ng,cn),this.core=e,this.logger=t}}class gg extends ci{constructor(e,t){super(e,t,sg,cn),this.core=e,this.logger=t}}class yg extends ci{constructor(e,t){super(e,t,og,cn),this.core=e,this.logger=t}}class un extends Tc{constructor(e){super(e),this.protocol=Ka,this.version=qa,this.name=yi.name,this.events=new Tt.exports.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||yi.name,this.metadata=(e==null?void 0:e.metadata)||Hl();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:_r(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||yi.logger}));this.core=(e==null?void 0:e.core)||new ig(e),this.logger=Se.generateChildLogger(t,this.name),this.session=new gg(this.core,this.logger),this.proposal=new pg(this.core,this.logger),this.pendingRequest=new yg(this.core,this.logger),this.engine=new dg(this)}static async init(e){const t=new un(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=Ie.getLocation=Ie.getLocationOrThrow=Ie.getNavigator=Ie.getNavigatorOrThrow=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Yt(r){let e;return typeof window!="undefined"&&typeof window[r]!="undefined"&&(e=window[r]),e}Ie.getFromWindow=Yt;function ar(r){const e=Yt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Ie.getFromWindowOrThrow=ar;function _g(){return ar("document")}Ie.getDocumentOrThrow=_g;function bg(){return Yt("document")}Ie.getDocument=bg;function wg(){return ar("navigator")}Ie.getNavigatorOrThrow=wg;function mg(){return Yt("navigator")}Ie.getNavigator=mg;function vg(){return ar("location")}Ie.getLocationOrThrow=vg;function Eg(){return Yt("location")}Ie.getLocation=Eg;function Dg(){return ar("crypto")}Ie.getCryptoOrThrow=Dg;function Sg(){return Yt("crypto")}Ie.getCrypto=Sg;function Og(){return ar("localStorage")}Ie.getLocalStorageOrThrow=Og;function Ig(){return Yt("localStorage")}Ie.getLocalStorage=Ig;var hn={};Object.defineProperty(hn,"__esModule",{value:!0});hn.getWindowMetadata=void 0;const bs=Ie;function xg(){let r,e;try{r=bs.getDocumentOrThrow(),e=bs.getLocationOrThrow()}catch{return null}function t(){const A=r.getElementsByTagName("link"),z=[];for(let N=0;N<A.length;N++){const T=A[N],B=T.getAttribute("rel");if(B&&B.toLowerCase().indexOf("icon")>-1){const M=T.getAttribute("href");if(M)if(M.toLowerCase().indexOf("https:")===-1&&M.toLowerCase().indexOf("http:")===-1&&M.indexOf("//")!==0){let K=e.protocol+"//"+e.host;if(M.indexOf("/")===0)K+=M;else{const _=e.pathname.split("/");_.pop(),K+=_.join("/")+"/"+M}z.push(K)}else if(M.indexOf("//")===0){const K=e.protocol+M;z.push(K)}else z.push(M)}}return z}function i(...A){const z=r.getElementsByTagName("meta");for(let N=0;N<z.length;N++){const T=z[N],B=["itemprop","property","name"].map(M=>T.getAttribute(M)).filter(M=>M?A.includes(M):!1);if(B.length&&B){const M=T.getAttribute("content");if(M)return M}}return""}function n(){let A=i("name","og:site_name","og:title","twitter:title");return A||(A=r.title),A}function c(){return i("description","og:description","twitter:description","keywords")}const y=n(),d=c(),g=e.origin,I=t();return{description:d,url:g,icons:I,name:y}}hn.getWindowMetadata=xg;var Pg={};(function(r){const e=Os,t=Is,i=Ss,n=wa,c=_=>_==null,y=Symbol("encodeFragmentIdentifier");function d(_){switch(_.arrayFormat){case"index":return D=>(b,w)=>{const m=b.length;return w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(D,_),"[",m,"]"].join("")]:[...b,[S(D,_),"[",S(m,_),"]=",S(w,_)].join("")]};case"bracket":return D=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(D,_),"[]"].join("")]:[...b,[S(D,_),"[]=",S(w,_)].join("")];case"colon-list-separator":return D=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(D,_),":list="].join("")]:[...b,[S(D,_),":list=",S(w,_)].join("")];case"comma":case"separator":case"bracket-separator":{const D=_.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(w,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?w:(m=m===null?"":m,w.length===0?[[S(b,_),D,S(m,_)].join("")]:[[w,S(m,_)].join(_.arrayFormatSeparator)])}default:return D=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,S(D,_)]:[...b,[S(D,_),"=",S(w,_)].join("")]}}function g(_){let D;switch(_.arrayFormat){case"index":return(b,w,m)=>{if(D=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!D){m[b]=w;return}m[b]===void 0&&(m[b]={}),m[b][D[1]]=w};case"bracket":return(b,w,m)=>{if(D=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!D){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"colon-list-separator":return(b,w,m)=>{if(D=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!D){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"comma":case"separator":return(b,w,m)=>{const s=typeof w=="string"&&w.includes(_.arrayFormatSeparator),h=typeof w=="string"&&!s&&A(w,_).includes(_.arrayFormatSeparator);w=h?A(w,_):w;const H=s||h?w.split(_.arrayFormatSeparator).map(o=>A(o,_)):w===null?w:A(w,_);m[b]=H};case"bracket-separator":return(b,w,m)=>{const s=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!s){m[b]=w&&A(w,_);return}const h=w===null?[]:w.split(_.arrayFormatSeparator).map(H=>A(H,_));if(m[b]===void 0){m[b]=h;return}m[b]=[].concat(m[b],h)};default:return(b,w,m)=>{if(m[b]===void 0){m[b]=w;return}m[b]=[].concat(m[b],w)}}}function I(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(_,D){return D.encode?D.strict?e(_):encodeURIComponent(_):_}function A(_,D){return D.decode?t(_):_}function z(_){return Array.isArray(_)?_.sort():typeof _=="object"?z(Object.keys(_)).sort((D,b)=>Number(D)-Number(b)).map(D=>_[D]):_}function N(_){const D=_.indexOf("#");return D!==-1&&(_=_.slice(0,D)),_}function T(_){let D="";const b=_.indexOf("#");return b!==-1&&(D=_.slice(b)),D}function B(_){_=N(_);const D=_.indexOf("?");return D===-1?"":_.slice(D+1)}function M(_,D){return D.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):D.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function K(_,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),I(D.arrayFormatSeparator);const b=g(D),w=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return w;for(const m of _.split("&")){if(m==="")continue;let[s,h]=i(D.decode?m.replace(/\+/g," "):m,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?h:A(h,D),b(A(s,D),h,w)}for(const m of Object.keys(w)){const s=w[m];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=M(s[h],D);else w[m]=M(s,D)}return D.sort===!1?w:(D.sort===!0?Object.keys(w).sort():Object.keys(w).sort(D.sort)).reduce((m,s)=>{const h=w[s];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?m[s]=z(h):m[s]=h,m},Object.create(null))}r.extract=B,r.parse=K,r.stringify=(_,D)=>{if(!_)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),I(D.arrayFormatSeparator);const b=h=>D.skipNull&&c(_[h])||D.skipEmptyString&&_[h]==="",w=d(D),m={};for(const h of Object.keys(_))b(h)||(m[h]=_[h]);const s=Object.keys(m);return D.sort!==!1&&s.sort(D.sort),s.map(h=>{const H=_[h];return H===void 0?"":H===null?S(h,D):Array.isArray(H)?H.length===0&&D.arrayFormat==="bracket-separator"?S(h,D)+"[]":H.reduce(w(h),[]).join("&"):S(h,D)+"="+S(H,D)}).filter(h=>h.length>0).join("&")},r.parseUrl=(_,D)=>{D=Object.assign({decode:!0},D);const[b,w]=i(_,"#");return Object.assign({url:b.split("?")[0]||"",query:K(B(_),D)},D&&D.parseFragmentIdentifier&&w?{fragmentIdentifier:A(w,D)}:{})},r.stringifyUrl=(_,D)=>{D=Object.assign({encode:!0,strict:!0,[y]:!0},D);const b=N(_.url).split("?")[0]||"",w=r.extract(_.url),m=r.parse(w,{sort:!1}),s=Object.assign(m,_.query);let h=r.stringify(s,D);h&&(h=`?${h}`);let H=T(_.url);return _.fragmentIdentifier&&(H=`#${D[y]?S(_.fragmentIdentifier,D):_.fragmentIdentifier}`),`${b}${h}${H}`},r.pick=(_,D,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[y]:!1},b);const{url:w,query:m,fragmentIdentifier:s}=r.parseUrl(_,b);return r.stringifyUrl({url:w,query:n(m,D),fragmentIdentifier:s},b)},r.exclude=(_,D,b)=>{const w=Array.isArray(D)?m=>!D.includes(m):(m,s)=>!D(m,s);return r.pick(_,w,b)}})(Pg);const Tg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Ag(r,e){const{message:t,code:i}=Tg[r];return{message:e?`${t} ${e}`:t,code:i}}function Ng(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function Cg(r){var e;const t=(e=r[Object.keys(r)[0]])==null?void 0:e.chains[0];return[t.split(":")[0],t.split(":")[1]]}function jt(r,e){let t;return e.rpcMap&&(t=e.rpcMap[Fg([r])]),t}function Fg(r){return Number(r[0].split(":")[1])}class Rg{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=t||jt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,t){const i=t||jt(e,this.namespace);return typeof i>"u"?void 0:new yr(new Vr(i))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}}class Ug{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||jt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||jt(e,this.namespace);return typeof i>"u"?void 0:new yr(new Vr(i))}}class Lg{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||jt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||jt(e,this.namespace);return typeof i>"u"?void 0:new yr(new Vr(i))}}class Mg{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||jt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||jt(e,this.namespace);return typeof i>"u"?void 0:new yr(new Vr(i))}}const ws="error",jg="wss://relay.walletconnect.com",$g="wc",zg="universal_provider",ms=`${$g}@${2}:${zg}:`;var Hg=Object.defineProperty,Bg=Object.defineProperties,Kg=Object.getOwnPropertyDescriptors,vs=Object.getOwnPropertySymbols,qg=Object.prototype.hasOwnProperty,Vg=Object.prototype.propertyIsEnumerable,Es=(r,e,t)=>e in r?Hg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ds=(r,e)=>{for(var t in e||(e={}))qg.call(e,t)&&Es(r,t,e[t]);if(vs)for(var t of vs(e))Vg.call(e,t)&&Es(r,t,e[t]);return r},Gg=(r,e)=>Bg(r,Kg(e));class ln{constructor(e){this.events=new Mi,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:_r(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||ws}))}static async init(e){const t=new ln(e);return await t.initialize(),t}async request(e,t){const[i,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Ds({},e),chainId:`${i}:${n}`,topic:this.session.topic})}sendAsync(e,t,i){this.request(e,i).then(n=>t(null,n)).catch(n=>t(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Ag("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:t}=e;return this.setNamespaces(t),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return t&&(this.uri=t,this.events.emit("display_uri",t)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,t){try{const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Ng(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${ms}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await un.init({logger:this.providerOpts.logger||ws,relayUrl:this.providerOpts.relayUrl||jg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new Rg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new Ug({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new Lg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new Mg({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,t.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:n}=t,c=(i=this.client)==null?void 0:i.session.get(e);this.session=Gg(Ds({},c),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${ms}/namespaces`,e),this.namespaces=e}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);return!t||!i?Cg(this.namespaces):[t,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t){const[i,n]=this.validateChain(t);this.getProvider(i).setDefaultChain(n),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const Xg=ln;export{Xg as UniversalProvider,ln as default};
